<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HumanGlue Project Manager - Development Roadmap Tool</title>
    <meta name="description" content="Interactive project management and development roadmap tool for the HumanGlue platform">
    <link rel="icon" href="https://hmnglue.com/favcon_HG.png" type="image/png">

    <!-- Open Graph -->
    <meta property="og:title" content="HumanGlue Project Manager">
    <meta property="og:description" content="Interactive development roadmap and project tracking">
    <meta property="og:image" content="https://hmnglue.com/HumnaGlue_logo_white_blue.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/panzoom@9.4.3/dist/panzoom.min.js"></script>
    <!-- Supabase for multi-user collaboration -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --hg-cyan: #61D8FE;
            --hg-royal-blue: #3B82F6;
            --hg-blue: #3B82F6;
            --hg-green: #10B981;
            --hg-amber: #F59E0B;
            --hg-red: #EF4444;
            --hg-bg-primary: #0a0a0f;
            --hg-bg-secondary: #12121a;
            --hg-bg-sidebar: #0f0f16;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background: var(--hg-bg-primary);
            color: #e5e7eb;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            overflow: hidden;
        }

        .gradient-text {
            background: linear-gradient(135deg, var(--hg-cyan), var(--hg-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Layout */
        .app-container {
            display: grid;
            grid-template-columns: 280px 1fr 400px;
            grid-template-rows: 64px 1fr;
            height: 100vh;
            width: 100vw;
            transition: grid-template-columns 0.3s ease;
        }

        .app-container.sidebar-collapsed {
            grid-template-columns: 56px 1fr 400px;
        }

        .app-container.right-collapsed {
            grid-template-columns: 280px 1fr 56px;
        }

        .app-container.sidebar-collapsed.right-collapsed {
            grid-template-columns: 56px 1fr 56px;
        }

        .header {
            grid-column: 1 / -1;
            background: var(--hg-bg-sidebar);
            border-bottom: 1px solid rgba(97, 216, 254, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
        }

        .sidebar {
            background: var(--hg-bg-sidebar);
            border-right: 1px solid rgba(97, 216, 254, 0.1);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 16px;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            position: relative;
        }

        .sidebar-collapsed .sidebar {
            padding: 16px 8px;
            width: 56px;
        }

        .sidebar-collapsed .sidebar .nav-section-title,
        .sidebar-collapsed .sidebar .sidebar-footer,
        .sidebar-collapsed .sidebar .stats-grid,
        .sidebar-collapsed .sidebar .custom-sections {
            display: none;
        }

        /* Hide text and badges in nav items when collapsed */
        .sidebar-collapsed .sidebar .nav-item {
            justify-content: center;
            padding: 10px;
            font-size: 0; /* Hide text content */
            overflow: hidden;
            width: 40px;
            height: 40px;
        }

        .sidebar-collapsed .sidebar .nav-item svg {
            margin-right: 0;
            font-size: 18px; /* Reset for SVG */
            flex-shrink: 0;
        }

        .sidebar-collapsed .sidebar .nav-item span {
            display: none;
        }

        /* Collapse toggle buttons */
        .collapse-toggle {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 40px;
            background: var(--hg-bg-secondary);
            border: 1px solid rgba(97, 216, 254, 0.2);
            border-radius: 0 6px 6px 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #9ca3af;
            transition: all 0.2s;
            z-index: 100;
        }

        .collapse-toggle:hover {
            background: rgba(97, 216, 254, 0.1);
            color: var(--hg-cyan);
            border-color: var(--hg-cyan);
        }

        .collapse-toggle.left {
            right: -20px;
        }

        .collapse-toggle.right {
            left: -20px;
            border-radius: 6px 0 0 6px;
        }

        .collapse-toggle svg {
            width: 14px;
            height: 14px;
            transition: transform 0.3s ease;
        }

        .sidebar-collapsed .collapse-toggle.left svg {
            transform: rotate(180deg);
        }

        .right-collapsed .collapse-toggle.right svg {
            transform: rotate(180deg);
        }

        /* Right panel collapse */
        .right-collapsed .right-panel {
            padding: 16px 8px;
        }

        .right-collapsed .right-panel .panel-tabs,
        .right-collapsed .right-panel .panel-content,
        .right-collapsed .right-panel .chat-container {
            display: none;
        }

        .right-collapsed .right-panel .collapsed-icons {
            display: flex;
        }

        .collapsed-icons {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 16px;
            padding-top: 16px;
        }

        .collapsed-icon-btn {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--hg-bg-primary);
            border: 1px solid rgba(97, 216, 254, 0.2);
            color: #9ca3af;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .collapsed-icon-btn:hover {
            background: rgba(97, 216, 254, 0.1);
            color: var(--hg-cyan);
            border-color: var(--hg-cyan);
        }

        .collapsed-icon-btn svg {
            width: 20px;
            height: 20px;
        }

        .main-canvas {
            background: var(--hg-bg-primary);
            position: relative;
            overflow: hidden;
        }

        .right-panel {
            background: var(--hg-bg-sidebar);
            border-left: 1px solid rgba(97, 216, 254, 0.1);
            display: flex;
            flex-direction: column;
        }

        /* Logo */
        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-img {
            height: 36px;
            width: auto;
        }

        /* Sidebar Styles */
        .nav-section {
            margin-bottom: 24px;
        }

        .nav-section-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #6b7280;
            margin-bottom: 8px;
            padding: 0 8px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            color: #9ca3af;
            border: none;
            background: transparent;
            width: 100%;
            text-align: left;
        }

        .nav-item:hover {
            background: rgba(97, 216, 254, 0.1);
            color: white;
        }

        .nav-item.active {
            background: rgba(97, 216, 254, 0.15);
            color: var(--hg-cyan);
            border-left: 2px solid var(--hg-cyan);
        }

        .nav-item-badge {
            margin-left: auto;
            padding: 2px 8px;
            border-radius: 9999px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge-green { background: rgba(16, 185, 129, 0.2); color: #10B981; }
        .badge-amber { background: rgba(245, 158, 11, 0.2); color: #F59E0B; }
        .badge-blue { background: rgba(59, 130, 246, 0.2); color: #3B82F6; }
        .badge-red { background: rgba(239, 68, 68, 0.2); color: #EF4444; }
        .badge-cyan { background: rgba(97, 216, 254, 0.2); color: #61D8FE; }

        /* Canvas Controls */
        .canvas-controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            gap: 8px;
            z-index: 100;
        }

        .control-btn {
            width: 40px;
            height: 40px;
            background: var(--hg-bg-secondary);
            border: 1px solid rgba(97, 216, 254, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #9ca3af;
            transition: all 0.2s;
        }

        .control-btn:hover {
            background: rgba(97, 216, 254, 0.1);
            color: var(--hg-cyan);
            border-color: var(--hg-cyan);
        }

        .zoom-display {
            background: var(--hg-bg-secondary);
            border: 1px solid rgba(97, 216, 254, 0.2);
            border-radius: 8px;
            padding: 0 16px;
            display: flex;
            align-items: center;
            color: #9ca3af;
            font-size: 13px;
        }

        /* Diagram Container */
        .diagram-container {
            width: 100%;
            height: 100%;
            cursor: grab;
        }

        .diagram-container:active {
            cursor: grabbing;
        }

        .diagram-wrapper {
            padding: 40px;
            min-width: 1400px;
            min-height: 900px;
        }

        /* Mermaid Customization - All Diagram Types */
        .mermaid {
            background: transparent !important;
        }

        .mermaid .node rect,
        .mermaid .node circle,
        .mermaid .node polygon {
            cursor: pointer !important;
        }

        /* Ensure text is visible across all diagram types */
        .mermaid text,
        .mermaid .nodeLabel,
        .mermaid .label,
        .mermaid .edgeLabel,
        .mermaid .messageText,
        .mermaid tspan {
            fill: #e5e7eb !important;
            color: #e5e7eb !important;
        }

        /* Sequence diagram styling */
        .mermaid .actor {
            fill: #1e293b !important;
            stroke: #61D8FE !important;
            stroke-width: 2px !important;
        }
        .mermaid .actor-line {
            stroke: #61D8FE !important;
        }
        .mermaid .messageLine0,
        .mermaid .messageLine1 {
            stroke: #61D8FE !important;
            stroke-width: 1.5px !important;
        }
        .mermaid .note {
            fill: #12121a !important;
            stroke: #3B82F6 !important;
        }

        /* ER diagram styling */
        .mermaid .entityBox {
            fill: #1e293b !important;
            stroke: #61D8FE !important;
            stroke-width: 2px !important;
        }
        .mermaid .entityLabel {
            fill: #61D8FE !important;
        }
        .mermaid .relationshipLabel {
            fill: #e5e7eb !important;
        }
        .mermaid .relationshipLine {
            stroke: #61D8FE !important;
        }
        .mermaid .attributeBoxOdd {
            fill: #12121a !important;
        }
        .mermaid .attributeBoxEven {
            fill: #1e293b !important;
        }

        /* Gantt chart styling */
        .mermaid .section {
            fill: #12121a !important;
        }
        .mermaid .section0,
        .mermaid .section2 {
            fill: #12121a !important;
        }
        .mermaid .section1,
        .mermaid .section3 {
            fill: #1e293b !important;
        }
        .mermaid .grid .tick line {
            stroke: #374151 !important;
        }
        .mermaid .grid .tick text {
            fill: #9ca3af !important;
        }
        .mermaid .task {
            stroke-width: 0 !important;
        }
        .mermaid .taskText {
            fill: #0a0a0f !important;
            font-weight: 500 !important;
        }
        .mermaid .taskTextOutsideRight,
        .mermaid .taskTextOutsideLeft {
            fill: #e5e7eb !important;
        }
        .mermaid .sectionTitle {
            fill: #e5e7eb !important;
            font-weight: 600 !important;
        }
        .mermaid .titleText {
            fill: #61D8FE !important;
            font-size: 20px !important;
            font-weight: 700 !important;
        }
        .mermaid .todayMarker {
            stroke: #EF4444 !important;
            stroke-width: 2px !important;
        }

        /* Cluster/subgraph styling */
        .mermaid .cluster rect {
            fill: #12121a !important;
            stroke: #3B82F6 !important;
            stroke-width: 1px !important;
        }
        .mermaid .cluster-label text {
            fill: #3B82F6 !important;
        }

        /* Mobile Toggle Buttons */
        .mobile-menu-btn,
        .mobile-panel-btn {
            display: none;
            width: 40px;
            height: 40px;
            background: var(--hg-bg-secondary);
            border: 1px solid rgba(97, 216, 254, 0.2);
            border-radius: 8px;
            color: #9ca3af;
            cursor: pointer;
            align-items: center;
            justify-content: center;
        }

        .mobile-menu-btn:hover,
        .mobile-panel-btn:hover {
            background: rgba(97, 216, 254, 0.1);
            color: var(--hg-cyan);
        }

        /* Mobile Responsive */
        @media (max-width: 1200px) {
            .app-container {
                grid-template-columns: 240px 1fr 320px;
            }
        }

        @media (max-width: 1024px) {
            .app-container {
                grid-template-columns: 1fr;
                grid-template-rows: 64px 1fr;
            }

            .sidebar {
                display: none;
                position: fixed;
                top: 64px;
                left: 0;
                width: 280px;
                height: calc(100vh - 64px);
                z-index: 1000;
                box-shadow: 4px 0 20px rgba(0, 0, 0, 0.5);
            }

            .sidebar.show {
                display: flex;
            }

            .right-panel {
                display: none;
                position: fixed;
                top: 64px;
                right: 0;
                width: 100%;
                max-width: 400px;
                height: calc(100vh - 64px);
                z-index: 1000;
                box-shadow: -4px 0 20px rgba(0, 0, 0, 0.5);
            }

            .right-panel.show {
                display: flex;
            }

            .mobile-menu-btn,
            .mobile-panel-btn {
                display: flex;
            }

            /* Hide desktop collapse toggles on mobile */
            .collapse-toggle {
                display: none !important;
            }

            .header {
                padding: 0 16px;
            }

            .logo-title {
                display: none;
            }

            .diagram-wrapper {
                padding: 20px;
                min-width: auto;
                min-height: auto;
            }

            .canvas-controls {
                bottom: 10px;
                left: 10px;
            }

            .control-btn {
                width: 36px;
                height: 36px;
            }

            .zoom-display {
                padding: 0 12px;
                font-size: 12px;
            }
        }

        @media (max-width: 640px) {
            .header {
                padding: 0 12px;
            }

            .logo-img {
                height: 28px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }

            .stat-item {
                padding: 12px;
            }

            .stat-number {
                font-size: 20px;
            }

            .header-actions {
                gap: 4px;
            }

            .header-actions .btn-text {
                display: none;
            }

            .header-actions .auto-save-text {
                display: none;
            }

            .btn-secondary svg:only-child,
            .btn-primary svg:only-child {
                margin: 0;
            }

            .right-panel {
                max-width: 100%;
            }

            .chat-input-container {
                padding: 12px;
            }

            .panel-content {
                padding: 12px;
            }

            .note-card {
                padding: 12px;
            }

            .diagram-info {
                padding: 12px 16px;
            }

            .diagram-info h2 {
                font-size: 18px;
            }
        }

        /* Overlay for mobile panels */
        .mobile-overlay {
            display: none;
            position: fixed;
            inset: 0;
            top: 64px;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .mobile-overlay.show {
            display: block;
        }

        /* Right Panel Tabs */
        .panel-tabs {
            display: flex;
            border-bottom: 1px solid rgba(97, 216, 254, 0.1);
        }

        .panel-tab {
            flex: 1;
            padding: 14px;
            text-align: center;
            font-size: 13px;
            font-weight: 500;
            color: #6b7280;
            cursor: pointer;
            border: none;
            background: transparent;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .panel-tab:hover {
            color: #9ca3af;
            background: rgba(97, 216, 254, 0.05);
        }

        .panel-tab.active {
            color: var(--hg-cyan);
            border-bottom-color: var(--hg-cyan);
        }

        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        /* Notes Panel */
        .note-card {
            background: var(--hg-bg-primary);
            border: 1px solid rgba(97, 216, 254, 0.1);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .note-card:hover {
            border-color: rgba(97, 216, 254, 0.3);
            transform: translateY(-1px);
        }

        .note-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .note-card-title {
            font-weight: 600;
            font-size: 14px;
            color: white;
        }

        .note-card-status {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .note-card-body {
            font-size: 13px;
            color: #9ca3af;
            line-height: 1.5;
        }

        .note-card-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 12px;
            font-size: 11px;
            color: #6b7280;
        }

        .add-note-btn {
            width: 100%;
            padding: 12px;
            background: rgba(97, 216, 254, 0.1);
            border: 1px dashed rgba(97, 216, 254, 0.3);
            border-radius: 8px;
            color: var(--hg-cyan);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .add-note-btn:hover {
            background: rgba(97, 216, 254, 0.15);
            border-color: var(--hg-cyan);
        }

        /* AI Chat Panel */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .chat-message {
            margin-bottom: 16px;
        }

        .chat-message.user {
            text-align: right;
        }

        .chat-message-bubble {
            display: inline-block;
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 16px;
            font-size: 13px;
            line-height: 1.5;
        }

        .chat-message.assistant .chat-message-bubble {
            background: var(--hg-bg-primary);
            border: 1px solid rgba(97, 216, 254, 0.1);
            color: #e5e7eb;
            border-bottom-left-radius: 4px;
        }

        .chat-message.user .chat-message-bubble {
            background: linear-gradient(135deg, var(--hg-cyan), var(--hg-blue));
            color: white;
            border-bottom-right-radius: 4px;
        }

        .chat-input-container {
            padding: 16px;
            border-top: 1px solid rgba(97, 216, 254, 0.1);
        }

        .chat-input-wrapper {
            display: flex;
            gap: 8px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 16px;
            background: var(--hg-bg-primary);
            border: 1px solid rgba(97, 216, 254, 0.2);
            border-radius: 12px;
            color: white;
            font-size: 13px;
            outline: none;
            transition: border-color 0.2s;
        }

        .chat-input:focus {
            border-color: var(--hg-cyan);
        }

        .chat-send-btn {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--hg-cyan), var(--hg-blue));
            border: none;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s, opacity 0.2s;
        }

        .chat-send-btn:hover {
            transform: scale(1.05);
        }

        /* Tasks Panel */
        .task-filters {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .task-filter {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            background: var(--hg-bg-primary);
            border: 1px solid rgba(97, 216, 254, 0.1);
            color: #9ca3af;
            transition: all 0.2s;
        }

        .task-filter:hover, .task-filter.active {
            border-color: var(--hg-cyan);
            color: var(--hg-cyan);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
        }

        .modal-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .modal {
            background: var(--hg-bg-secondary);
            border: 1px solid rgba(97, 216, 254, 0.2);
            border-radius: 16px;
            width: 520px;
            max-width: 90vw;
            max-height: 90vh;
            overflow: hidden;
            transform: scale(0.95);
            transition: transform 0.2s;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid rgba(97, 216, 254, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: white;
        }

        .modal-close {
            width: 32px;
            height: 32px;
            background: transparent;
            border: none;
            color: #6b7280;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: rgba(239, 68, 68, 0.1);
            color: var(--hg-red);
        }

        .modal-body {
            padding: 24px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: #9ca3af;
            margin-bottom: 8px;
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 12px 16px;
            background: var(--hg-bg-primary);
            border: 1px solid rgba(97, 216, 254, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 14px;
            font-family: inherit;
            outline: none;
            transition: border-color 0.2s;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            border-color: var(--hg-cyan);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-select {
            cursor: pointer;
        }

        .modal-actions {
            padding: 16px 24px;
            border-top: 1px solid rgba(97, 216, 254, 0.1);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-family: inherit;
        }

        .btn-secondary {
            background: var(--hg-bg-primary);
            border: 1px solid rgba(97, 216, 254, 0.2);
            color: #9ca3af;
        }

        .btn-secondary:hover {
            background: rgba(97, 216, 254, 0.1);
            color: white;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--hg-cyan), var(--hg-blue));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(97, 216, 254, 0.3);
        }

        .btn-danger {
            background: rgba(239, 68, 68, 0.2);
            color: #EF4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .btn-danger:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        /* Status Colors */
        .status-todo { background: rgba(107, 114, 128, 0.2); color: #9ca3af; }
        .status-in-progress { background: rgba(245, 158, 11, 0.2); color: #F59E0B; }
        .status-completed { background: rgba(16, 185, 129, 0.2); color: #10B981; }
        .status-blocked { background: rgba(239, 68, 68, 0.2); color: #EF4444; }

        /* Priority Colors */
        .priority-low { border-left: 3px solid #6b7280; }
        .priority-medium { border-left: 3px solid var(--hg-amber); }
        .priority-high { border-left: 3px solid var(--hg-red); }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .stat-mini {
            background: var(--hg-bg-primary);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
        }

        .stat-mini-value {
            font-size: 24px;
            font-weight: 700;
        }

        .stat-mini-label {
            font-size: 11px;
            color: #6b7280;
            margin-top: 2px;
        }

        /* Sidebar Footer */
        .sidebar-footer {
            margin-top: auto;
            padding-top: 16px;
            border-top: 1px solid rgba(97, 216, 254, 0.1);
        }

        /* Responsive */
        @media (max-width: 1400px) {
            .app-container {
                grid-template-columns: 240px 1fr 360px;
            }
        }

        @media (max-width: 1100px) {
            .app-container {
                grid-template-columns: 1fr;
                grid-template-rows: 64px 1fr auto;
            }
            .sidebar { display: none; }
            .right-panel {
                height: 350px;
                border-left: none;
                border-top: 1px solid rgba(97, 216, 254, 0.1);
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(97, 216, 254, 0.2); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(97, 216, 254, 0.3); }

        /* AI Hot Buttons */
        .ai-hot-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            padding: 12px;
            border-top: 1px solid rgba(97, 216, 254, 0.1);
            background: rgba(10, 10, 15, 0.5);
        }

        .ai-hot-btn {
            padding: 6px 12px;
            font-size: 11px;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid rgba(97, 216, 254, 0.2);
            background: var(--hg-bg-primary);
            color: #9ca3af;
            display: flex;
            align-items: center;
            gap: 4px;
            font-family: inherit;
        }

        .ai-hot-btn:hover {
            border-color: var(--hg-cyan);
            color: var(--hg-cyan);
            background: rgba(97, 216, 254, 0.1);
        }

        .ai-hot-btn svg {
            width: 12px;
            height: 12px;
        }

        /* AI Action Cards in responses */
        .ai-action-card {
            background: rgba(97, 216, 254, 0.05);
            border: 1px solid rgba(97, 216, 254, 0.15);
            border-radius: 10px;
            padding: 12px;
            margin: 8px 0;
        }

        .ai-action-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .ai-action-icon {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ai-action-icon.status { background: rgba(16, 185, 129, 0.2); color: #10B981; }
        .ai-action-icon.task { background: rgba(59, 130, 246, 0.2); color: #3B82F6; }
        .ai-action-icon.info { background: rgba(59, 130, 246, 0.2); color: #3B82F6; }
        .ai-action-icon.warning { background: rgba(245, 158, 11, 0.2); color: #F59E0B; }
        .ai-action-icon.blocker { background: rgba(239, 68, 68, 0.2); color: #EF4444; }

        .ai-action-title {
            font-weight: 600;
            font-size: 13px;
            color: #e5e7eb;
        }

        .ai-action-content {
            font-size: 12px;
            color: #9ca3af;
            line-height: 1.5;
        }

        .ai-action-content ul {
            margin: 6px 0;
            padding-left: 16px;
        }

        .ai-action-content li {
            margin: 4px 0;
        }

        .ai-response-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .ai-response-btn {
            padding: 5px 10px;
            font-size: 11px;
            border-radius: 6px;
            cursor: pointer;
            border: none;
            font-family: inherit;
            transition: all 0.15s;
        }

        .ai-response-btn.primary {
            background: linear-gradient(135deg, var(--hg-cyan), var(--hg-blue));
            color: white;
        }

        .ai-response-btn.secondary {
            background: rgba(97, 216, 254, 0.1);
            border: 1px solid rgba(97, 216, 254, 0.2);
            color: var(--hg-cyan);
        }

        .ai-response-btn:hover {
            transform: translateY(-1px);
            opacity: 0.9;
        }

        /* Typing indicator */
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 8px 0;
        }
        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--hg-cyan);
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
            30% { transform: translateY(-4px); opacity: 1; }
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6b7280;
        }

        .empty-state svg {
            margin: 0 auto 16px;
            opacity: 0.5;
        }

        /* Diagram title overlay */
        .diagram-title-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(10, 10, 15, 0.8);
            backdrop-filter: blur(8px);
            padding: 16px 20px;
            border-radius: 12px;
            border: 1px solid rgba(97, 216, 254, 0.1);
        }

        /* Quick actions */
        .quick-actions {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
            display: flex;
            gap: 8px;
        }

        /* Interactive Gantt Chart Styles */
        .interactive-gantt {
            width: 100%;
            padding: 20px;
            overflow-x: auto;
        }

        .gantt-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(97, 216, 254, 0.1);
        }

        .gantt-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--hg-cyan);
        }

        .gantt-controls {
            display: flex;
            gap: 12px;
        }

        .gantt-timeline {
            position: relative;
            min-height: 400px;
        }

        .gantt-months {
            display: flex;
            border-bottom: 1px solid rgba(97, 216, 254, 0.1);
            padding-bottom: 8px;
            margin-bottom: 16px;
            position: sticky;
            top: 0;
            background: var(--hg-bg-primary);
            z-index: 10;
        }

        .gantt-month {
            flex: 1;
            min-width: 80px;
            text-align: center;
            font-size: 12px;
            font-weight: 500;
            color: #9ca3af;
        }

        .gantt-section {
            margin-bottom: 24px;
        }

        .gantt-section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--hg-blue);
            margin-bottom: 12px;
            padding: 8px 12px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 6px;
            display: inline-block;
        }

        .gantt-items {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .gantt-item {
            display: flex;
            align-items: center;
            height: 36px;
            position: relative;
        }

        .gantt-item-label {
            width: 180px;
            flex-shrink: 0;
            font-size: 13px;
            color: #e5e7eb;
            padding-right: 16px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .gantt-item-bar-container {
            flex: 1;
            position: relative;
            height: 100%;
        }

        .gantt-item-bar {
            position: absolute;
            height: 28px;
            top: 4px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            padding: 0 12px;
            font-size: 12px;
            font-weight: 500;
            color: white;
            background: linear-gradient(135deg, var(--hg-cyan), var(--hg-blue));
            box-shadow: 0 2px 8px rgba(97, 216, 254, 0.3);
        }

        .gantt-item-bar:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(97, 216, 254, 0.4);
        }

        .gantt-item-bar.status-done {
            background: linear-gradient(135deg, #10B981, #059669);
        }

        .gantt-item-bar.status-active {
            background: linear-gradient(135deg, #F59E0B, #D97706);
        }

        .gantt-item-bar.status-blocked {
            background: linear-gradient(135deg, #EF4444, #DC2626);
        }

        .gantt-item-bar .drag-handle {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 12px;
            cursor: ew-resize;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 0 6px 6px 0;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .gantt-item-bar:hover .drag-handle {
            opacity: 1;
        }

        .gantt-grid-lines {
            position: absolute;
            inset: 0;
            pointer-events: none;
            display: flex;
        }

        .gantt-grid-line {
            flex: 1;
            border-left: 1px solid rgba(97, 216, 254, 0.05);
        }

        .gantt-add-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(97, 216, 254, 0.1);
            border: 1px dashed rgba(97, 216, 254, 0.3);
            border-radius: 8px;
            color: var(--hg-cyan);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 12px;
        }

        .gantt-add-btn:hover {
            background: rgba(97, 216, 254, 0.2);
            border-color: var(--hg-cyan);
        }

        /* AI Tooltip Styles */
        .ai-tooltip {
            position: fixed;
            z-index: 9999;
            max-width: 400px;
            background: var(--hg-bg-secondary);
            border: 1px solid rgba(97, 216, 254, 0.3);
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
        }

        .ai-tooltip.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .ai-tooltip-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(97, 216, 254, 0.1);
        }

        .ai-tooltip-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--hg-cyan), var(--hg-blue));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ai-tooltip-title {
            font-weight: 600;
            color: white;
        }

        .ai-tooltip-content {
            font-size: 13px;
            color: #e5e7eb;
            line-height: 1.5;
        }

        .ai-tooltip-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(97, 216, 254, 0.1);
        }

        .ai-tooltip-btn {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }

        .ai-tooltip-btn-primary {
            background: var(--hg-cyan);
            color: #0a0a0f;
        }

        .ai-tooltip-btn-secondary {
            background: rgba(97, 216, 254, 0.1);
            color: var(--hg-cyan);
        }

        /* AI Thinking Animation */
        .ai-thinking {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            color: var(--hg-cyan);
        }

        .ai-thinking-dot {
            width: 6px;
            height: 6px;
            background: var(--hg-cyan);
            border-radius: 50%;
            animation: ai-pulse 1.4s infinite ease-in-out;
        }

        .ai-thinking-dot:nth-child(2) { animation-delay: 0.2s; }
        .ai-thinking-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes ai-pulse {
            0%, 80%, 100% { transform: scale(0.6); opacity: 0.4; }
            40% { transform: scale(1); opacity: 1; }
        }

        /* AI Suggestion Cards */
        .ai-suggestion {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
        }

        .ai-suggestion-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--hg-blue);
            margin-bottom: 8px;
        }

        .ai-suggestion-content {
            font-size: 13px;
            color: #e5e7eb;
        }

        /* Quick AI Actions in Header */
        .ai-quick-ask {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: linear-gradient(135deg, rgba(97, 216, 254, 0.1), rgba(59, 130, 246, 0.1));
            border: 1px solid rgba(97, 216, 254, 0.2);
            border-radius: 20px;
            color: var(--hg-cyan);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .ai-quick-ask:hover {
            background: linear-gradient(135deg, rgba(97, 216, 254, 0.2), rgba(59, 130, 246, 0.2));
            border-color: var(--hg-cyan);
        }

        .ai-quick-ask svg {
            width: 16px;
            height: 16px;
        }

        /* Context Panel for AI */
        .ai-context-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 12px;
            font-size: 11px;
            color: var(--hg-blue);
        }

        /* ==========================================
           KANBAN BOARD STYLES
           ========================================== */
        .kanban-board {
            display: flex;
            gap: 16px;
            padding: 20px;
            min-height: 100%;
            overflow-x: auto;
        }

        .kanban-column {
            flex: 0 0 280px;
            background: var(--hg-bg-primary);
            border-radius: 12px;
            border: 1px solid rgba(97, 216, 254, 0.1);
            display: flex;
            flex-direction: column;
            max-height: calc(100vh - 200px);
        }

        .kanban-column-header {
            padding: 16px;
            border-bottom: 1px solid rgba(97, 216, 254, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }

        .kanban-column-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 14px;
        }

        .kanban-column-count {
            background: rgba(97, 216, 254, 0.1);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            color: var(--hg-cyan);
        }

        .kanban-column-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .kanban-column-dot.backlog { background: #6b7280; }
        .kanban-column-dot.todo { background: #3B82F6; }
        .kanban-column-dot.progress { background: #F59E0B; }
        .kanban-column-dot.review { background: #3B82F6; }
        .kanban-column-dot.done { background: #10B981; }

        .kanban-column-items {
            padding: 12px;
            flex: 1;
            overflow-y: auto;
            min-height: 200px;
        }

        .kanban-column-items.drag-over {
            background: rgba(97, 216, 254, 0.05);
        }

        .kanban-card {
            background: var(--hg-bg-secondary);
            border: 1px solid rgba(97, 216, 254, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 10px;
            cursor: grab;
            transition: all 0.2s;
        }

        .kanban-card:active {
            cursor: grabbing;
        }

        .kanban-card.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }

        .kanban-card:hover {
            border-color: var(--hg-cyan);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transform: translateY(-2px);
        }

        .kanban-card-title {
            font-size: 13px;
            font-weight: 500;
            color: #e5e7eb;
            margin-bottom: 8px;
        }

        .kanban-card-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .kanban-card-tag {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .kanban-card-tag.feature { background: rgba(59, 130, 246, 0.2); color: #3B82F6; }
        .kanban-card-tag.bug { background: rgba(239, 68, 68, 0.2); color: #EF4444; }
        .kanban-card-tag.enhancement { background: rgba(59, 130, 246, 0.2); color: #3B82F6; }
        .kanban-card-tag.docs { background: rgba(16, 185, 129, 0.2); color: #10B981; }
        .kanban-card-tag.design { background: rgba(236, 72, 153, 0.2); color: #EC4899; }

        .kanban-card-points {
            background: rgba(97, 216, 254, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            color: var(--hg-cyan);
            font-weight: 600;
        }

        .kanban-card-assignee {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--hg-cyan), var(--hg-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 600;
            color: white;
            margin-left: auto;
        }

        .kanban-add-card {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 12px;
            margin: 0 12px 12px;
            background: transparent;
            border: 1px dashed rgba(97, 216, 254, 0.2);
            border-radius: 8px;
            color: #6b7280;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .kanban-add-card:hover {
            border-color: var(--hg-cyan);
            color: var(--hg-cyan);
            background: rgba(97, 216, 254, 0.05);
        }

        .kanban-sprint-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            background: var(--hg-bg-primary);
            border-bottom: 1px solid rgba(97, 216, 254, 0.1);
        }

        .kanban-sprint-info {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .kanban-sprint-name {
            font-size: 18px;
            font-weight: 600;
            color: white;
        }

        .kanban-sprint-dates {
            font-size: 12px;
            color: #6b7280;
        }

        .kanban-sprint-progress {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .kanban-progress-bar {
            width: 200px;
            height: 6px;
            background: rgba(97, 216, 254, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .kanban-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--hg-cyan), var(--hg-green));
            border-radius: 3px;
            transition: width 0.3s;
        }

        .kanban-progress-text {
            font-size: 12px;
            color: var(--hg-cyan);
            font-weight: 600;
        }

        /* ==========================================
           NODE EDITING TOOLBAR
           ========================================== */
        .node-toolbar {
            position: fixed;
            display: none;
            background: var(--hg-bg-secondary);
            border: 1px solid rgba(97, 216, 254, 0.3);
            border-radius: 10px;
            padding: 8px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            gap: 4px;
        }

        .node-toolbar.visible {
            display: flex;
        }

        .node-toolbar-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: 1px solid transparent;
            background: transparent;
            color: #9ca3af;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .node-toolbar-btn:hover {
            background: rgba(97, 216, 254, 0.1);
            border-color: var(--hg-cyan);
            color: var(--hg-cyan);
        }

        .node-toolbar-btn.danger:hover {
            background: rgba(239, 68, 68, 0.1);
            border-color: #EF4444;
            color: #EF4444;
        }

        .node-toolbar-separator {
            width: 1px;
            height: 28px;
            background: rgba(97, 216, 254, 0.2);
            margin: 0 4px;
        }

        /* Node Palette for adding nodes */
        .node-palette {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            background: var(--hg-bg-secondary);
            border: 1px solid rgba(97, 216, 254, 0.3);
            border-radius: 12px;
            padding: 12px 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            z-index: 900;
            gap: 8px;
        }

        .node-palette.visible {
            display: flex;
            align-items: center;
        }

        .node-palette-title {
            font-size: 11px;
            color: #6b7280;
            margin-right: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .node-palette-item {
            padding: 8px 14px;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            border: 1px solid rgba(97, 216, 254, 0.2);
            background: var(--hg-bg-primary);
            color: #9ca3af;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .node-palette-item:hover {
            border-color: var(--hg-cyan);
            color: white;
            background: rgba(97, 216, 254, 0.1);
        }

        .node-palette-item.component { border-left: 3px solid var(--hg-cyan); }
        .node-palette-item.database { border-left: 3px solid var(--hg-green); }
        .node-palette-item.service { border-left: 3px solid var(--hg-blue); }
        .node-palette-item.external { border-left: 3px solid var(--hg-amber); }

        /* ==========================================
           ENHANCED ROADMAP STYLES
           ========================================== */
        .roadmap-milestone {
            position: absolute;
            width: 16px;
            height: 16px;
            background: var(--hg-amber);
            transform: rotate(45deg);
            border: 2px solid var(--hg-bg-secondary);
            z-index: 10;
            cursor: pointer;
        }

        .roadmap-milestone:hover {
            transform: rotate(45deg) scale(1.2);
        }

        .roadmap-milestone-label {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) rotate(-45deg);
            font-size: 10px;
            white-space: nowrap;
            color: var(--hg-amber);
        }

        .roadmap-dependency-line {
            stroke: var(--hg-blue);
            stroke-width: 2;
            fill: none;
            stroke-dasharray: 4 2;
            opacity: 0.6;
        }

        .gantt-item-progress {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: rgba(16, 185, 129, 0.4);
            border-radius: 4px 0 0 4px;
            transition: width 0.3s;
        }

        .roadmap-filters {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .roadmap-filter-btn {
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 11px;
            border: 1px solid rgba(97, 216, 254, 0.2);
            background: transparent;
            color: #9ca3af;
            cursor: pointer;
            transition: all 0.2s;
        }

        .roadmap-filter-btn.active,
        .roadmap-filter-btn:hover {
            border-color: var(--hg-cyan);
            color: var(--hg-cyan);
            background: rgba(97, 216, 254, 0.1);
        }

        /* Sprint Task Modal */
        .sprint-task-modal .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .sprint-stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            padding: 16px 20px;
            background: var(--hg-bg-primary);
            border-bottom: 1px solid rgba(97, 216, 254, 0.1);
        }

        .sprint-stat {
            text-align: center;
        }

        .sprint-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--hg-cyan);
        }

        .sprint-stat-label {
            font-size: 11px;
            color: #6b7280;
            margin-top: 2px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo-container">
                <!-- Mobile menu button -->
                <button class="mobile-menu-btn" onclick="toggleMobileSidebar()" aria-label="Toggle menu">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                </button>
                <img src="https://hmnglue.com/HumnaGlue_logo_white_blue.png" alt="HumanGlue" class="logo-img">
                <div class="logo-title" style="border-left: 1px solid rgba(97, 216, 254, 0.2); padding-left: 12px; margin-left: 4px;">
                    <div style="font-size: 14px; font-weight: 600; color: white;">Project Manager</div>
                    <div style="font-size: 11px; color: #6b7280;">Development Roadmap Tool</div>
                </div>
            </div>
            <div class="header-actions" style="display: flex; align-items: center; gap: 16px;">
                <div class="auto-save-text" style="font-size: 12px; color: #6b7280;">
                    Auto-saved <span id="lastSaved" style="color: var(--hg-cyan);">just now</span>
                </div>
                <button onclick="importNotes()" class="btn btn-secondary" style="padding: 8px 14px; font-size: 13px;">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin-right: 6px; vertical-align: -3px;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                    </svg>
                    <span class="btn-text">Import</span>
                </button>
                <button onclick="exportNotes()" class="btn btn-secondary" style="padding: 8px 14px; font-size: 13px;">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin-right: 6px; vertical-align: -3px;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                    </svg>
                    <span class="btn-text">Export</span>
                </button>
                <button onclick="window.open('https://hmnglue.com', '_blank')" class="btn btn-primary" style="padding: 8px 14px; font-size: 13px;">
                    <span class="btn-text">Open Platform</span>
                    <svg class="mobile-only" width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="display: none;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                    </svg>
                </button>
                <!-- Mobile tasks panel button -->
                <button class="mobile-panel-btn" onclick="toggleRightPanel()" aria-label="Toggle tasks">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Mobile overlay -->
        <div class="mobile-overlay" id="mobileOverlay" onclick="closeAllPanels()"></div>

        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Collapse Toggle -->
            <button class="collapse-toggle left" onclick="toggleSidebar()" title="Toggle sidebar">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
            </button>
            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-mini">
                    <div class="stat-mini-value" style="color: var(--hg-green);" id="statCompleted">0</div>
                    <div class="stat-mini-label">Completed</div>
                </div>
                <div class="stat-mini">
                    <div class="stat-mini-value" style="color: var(--hg-amber);" id="statProgress">0</div>
                    <div class="stat-mini-label">In Progress</div>
                </div>
                <div class="stat-mini">
                    <div class="stat-mini-value" style="color: var(--hg-blue);" id="statTodo">0</div>
                    <div class="stat-mini-label">To Do</div>
                </div>
                <div class="stat-mini">
                    <div class="stat-mini-value" style="color: var(--hg-red);" id="statBlocked">0</div>
                    <div class="stat-mini-label">Blocked</div>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Architecture Views</div>
                <button class="nav-item active" onclick="loadDiagram('platform', this)">
                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                    </svg>
                    Platform Overview
                </button>
                <button class="nav-item" onclick="loadDiagram('roles', this)">
                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                    </svg>
                    User Roles
                    <span class="nav-item-badge badge-green">6</span>
                </button>
                <button class="nav-item" onclick="loadDiagram('whitelabel', this)">
                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"/>
                    </svg>
                    White-Label
                    <span class="nav-item-badge badge-amber">65%</span>
                </button>
                <button class="nav-item" onclick="loadDiagram('database', this)">
                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"/>
                    </svg>
                    Database
                </button>
                <button class="nav-item" onclick="loadDiagram('assessment', this)">
                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                    </svg>
                    Assessment Flow
                </button>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Development</div>
                <button class="nav-item" onclick="loadDiagram('roadmap', this)">
                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
                    </svg>
                    2026 Roadmap
                    <span class="nav-item-badge badge-blue">Q1-Q4</span>
                </button>
                <button class="nav-item" onclick="loadDiagram('sprint', this)">
                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                    </svg>
                    Sprint Board
                    <span class="nav-item-badge badge-cyan">Kanban</span>
                </button>
                <button class="nav-item" onclick="loadDiagram('mindmap', this)">
                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"/>
                    </svg>
                    Mind Map
                    <span class="nav-item-badge badge-green">New</span>
                </button>
                <button class="nav-item" onclick="loadDiagram('blockers', this)">
                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                    </svg>
                    Blockers
                    <span class="nav-item-badge badge-red">2</span>
                </button>
                <button class="nav-item" onclick="loadDiagram('integrations', this)">
                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 00-1-1H4a2 2 0 110-4h1a1 1 0 001-1V7a1 1 0 011-1h3a1 1 0 001-1V4z"/>
                    </svg>
                    Integrations
                </button>
            </div>

            <!-- Custom Sections -->
            <div class="nav-section">
                <div class="nav-section-title" style="display: flex; justify-content: space-between; align-items: center;">
                    Custom Views
                    <button onclick="openAddSectionModal()" style="background: none; border: none; cursor: pointer; padding: 2px;" title="Add new section">
                        <svg width="14" height="14" fill="none" stroke="var(--hg-cyan)" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                        </svg>
                    </button>
                </div>
                <div id="customSectionsContainer">
                    <!-- Custom sections will be added here dynamically -->
                </div>
                <button class="nav-item" onclick="openAddSectionModal()" style="color: #6b7280; font-style: italic; font-size: 12px;">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                    </svg>
                    Add custom section...
                </button>
            </div>

            <div class="sidebar-footer">
                <button class="nav-item" onclick="openSettingsModal()">
                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                    Settings
                </button>
                <div style="text-align: center; padding: 12px; font-size: 11px; color: #4b5563;">
                    HumanGlue Project Manager v1.0
                </div>
            </div>
        </aside>

        <!-- Main Canvas -->
        <main class="main-canvas">
            <div id="diagramContainer" class="diagram-container">
                <div class="diagram-wrapper">
                    <div id="mermaidDiagram" class="mermaid"></div>
                </div>
            </div>

            <!-- Diagram Title -->
            <div class="diagram-title-overlay">
                <h2 id="diagramTitle" style="font-size: 20px; font-weight: 700; color: white; margin: 0;">Platform Overview</h2>
                <p id="diagramSubtitle" style="font-size: 12px; color: #6b7280; margin: 4px 0 0 0;">Click nodes to add development notes</p>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <button class="control-btn" onclick="openNoteModal()" title="Add Note">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                    </svg>
                </button>
                <button class="control-btn" onclick="toggleFullscreen()" title="Fullscreen">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"/>
                    </svg>
                </button>
            </div>

            <!-- Canvas Controls -->
            <div class="canvas-controls">
                <button class="control-btn" onclick="zoomIn()" title="Zoom In (Ctrl++)">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"/>
                    </svg>
                </button>
                <button class="control-btn" onclick="zoomOut()" title="Zoom Out (Ctrl+-)">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"/>
                    </svg>
                </button>
                <button class="control-btn" onclick="resetZoom()" title="Reset (Ctrl+0)">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                </button>
                <div class="zoom-display">
                    <span id="zoomLevel">100%</span>
                </div>
                <button class="control-btn" onclick="fitToScreen()" title="Fit to Screen">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"/>
                    </svg>
                </button>
            </div>
        </main>

        <!-- Right Panel -->
        <aside class="right-panel">
            <!-- Collapse Toggle -->
            <button class="collapse-toggle right" onclick="toggleRightPanel()" title="Toggle panel">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
            </button>
            <!-- Collapsed State Icons -->
            <div class="collapsed-icons">
                <button class="collapsed-icon-btn" onclick="toggleRightPanel(); switchTab('notes', document.querySelector('.panel-tab'))" title="Tasks">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                    </svg>
                </button>
                <button class="collapsed-icon-btn" onclick="toggleRightPanel(); switchTab('chat', document.querySelectorAll('.panel-tab')[1])" title="AI Assistant">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
                    </svg>
                </button>
                <button class="collapsed-icon-btn" onclick="openNoteModal()" title="Add Task">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                    </svg>
                </button>
            </div>
            <div class="panel-tabs">
                <button class="panel-tab active" onclick="switchTab('notes', this)">Tasks & Notes</button>
                <button class="panel-tab" onclick="switchTab('chat', this)">AI Assistant</button>
            </div>

            <!-- Notes Panel -->
            <div id="notesPanel" class="panel-content">
                <div class="task-filters">
                    <button class="task-filter active" onclick="filterNotes('all', this)">All</button>
                    <button class="task-filter" onclick="filterNotes('todo', this)">To Do</button>
                    <button class="task-filter" onclick="filterNotes('in-progress', this)">In Progress</button>
                    <button class="task-filter" onclick="filterNotes('completed', this)">Done</button>
                    <button class="task-filter" onclick="filterNotes('blocked', this)">Blocked</button>
                </div>
                <div id="notesList"></div>
                <button class="add-note-btn" onclick="openNoteModal()">
                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                    </svg>
                    Add Task or Note
                </button>
            </div>

            <!-- Chat Panel -->
            <div id="chatPanel" class="panel-content" style="display: none;">
                <div class="chat-container">
                    <!-- Expert Advisor Selector -->
                    <div id="expertSelector" style="padding: 12px; background: var(--bg-secondary); border-bottom: 1px solid var(--border-subtle);">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px;">Chat with Expert</span>
                            <span class="nav-item-badge badge-cyan" style="font-size: 9px;">Mind Reasoner</span>
                        </div>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <button onclick="selectExpertForChat('ai')" id="expert-btn-ai" class="expert-chip active" style="display: flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 20px; border: 1px solid var(--hg-cyan); background: rgba(97, 216, 254, 0.1); color: var(--hg-cyan); cursor: pointer; font-size: 12px; transition: all 0.2s;">
                                 AI Assistant
                            </button>
                            <button onclick="selectExpertForChat('steve-jobs')" id="expert-btn-steve-jobs" class="expert-chip" style="display: flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 20px; border: 1px solid var(--border-subtle); background: var(--bg-tertiary); color: var(--text-secondary); cursor: pointer; font-size: 12px; transition: all 0.2s;">
                                 Steve Jobs
                            </button>
                            <button onclick="selectExpertForChat('paul-graham')" id="expert-btn-paul-graham" class="expert-chip" style="display: flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 20px; border: 1px solid var(--border-subtle); background: var(--bg-tertiary); color: var(--text-secondary); cursor: pointer; font-size: 12px; transition: all 0.2s;">
                                 Paul Graham
                            </button>
                            <button onclick="selectExpertForChat('jony-ive')" id="expert-btn-jony-ive" class="expert-chip" style="display: flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 20px; border: 1px solid var(--border-subtle); background: var(--bg-tertiary); color: var(--text-secondary); cursor: pointer; font-size: 12px; transition: all 0.2s;">
                                 Jony Ive
                            </button>
                        </div>
                    </div>
                    <div id="chatMessages" class="chat-messages">
                        <div class="chat-message assistant">
                            <div class="chat-message-bubble">
                                <strong style="color: var(--hg-cyan);"> HumanGlue AI Project Assistant</strong>
                                <br><br>
                                I'm your AI-powered development partner for the HumanGlue platform. I understand the entire codebase, architecture, and roadmap.
                                <br><br>
                                <div class="ai-action-card" style="margin: 8px 0;">
                                    <div class="ai-action-header">
                                        <div class="ai-action-icon info">
                                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                                            </svg>
                                        </div>
                                        <div class="ai-action-title">Quick Actions</div>
                                    </div>
                                    <div class="ai-action-content">
                                        <ul style="margin:0;padding-left:16px;">
                                            <li>Use <strong>hot buttons</strong> below for instant insights</li>
                                            <li>Click <strong>diagram nodes</strong> for component context</li>
                                            <li>Select an <strong>Expert Advisor</strong> above for specialized guidance</li>
                                        </ul>
                                    </div>
                                </div>
                                <p style="font-size:12px;color:#6b7280;margin-top:8px;">Try: "project status", "next steps", or "what's blocking us?"</p>
                            </div>
                        </div>
                    </div>
                    <div class="chat-input-container">
                        <div class="chat-input-wrapper">
                            <input type="text" id="chatInput" class="chat-input" placeholder="Ask about the project..." onkeypress="if(event.key==='Enter')sendMessage()">
                            <button class="chat-send-btn" onclick="sendMessage()">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <!-- AI Hot Buttons -->
                    <div class="ai-hot-buttons">
                        <button class="ai-hot-btn" onclick="askAI('project status')">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
                            Project Status
                        </button>
                        <button class="ai-hot-btn" onclick="askAI('blockers')">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                            Blockers
                        </button>
                        <button class="ai-hot-btn" onclick="askAI('next steps')">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/></svg>
                            Next Steps
                        </button>
                        <button class="ai-hot-btn" onclick="askAI('database')">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"/></svg>
                            Database
                        </button>
                        <button class="ai-hot-btn" onclick="askAI('current diagram')">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"/></svg>
                            This View
                        </button>
                        <button class="ai-hot-btn" onclick="askAI('tasks')">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg>
                            My Tasks
                        </button>
                        <button class="ai-hot-btn" onclick="askAI('architecture')">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>
                            Architecture
                        </button>
                        <button class="ai-hot-btn" onclick="askAI('files')">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/></svg>
                            Files
                        </button>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <!-- Add/Edit Note Modal -->
    <div id="noteModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="noteModalTitle">Add Task</h3>
                <button class="modal-close" onclick="closeNoteModal()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Title *</label>
                    <input type="text" id="noteTitle" class="form-input" placeholder="e.g., Implement Stripe webhooks">
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea id="noteDescription" class="form-textarea" placeholder="Describe what needs to be built, changed, or investigated..."></textarea>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select id="noteStatus" class="form-select">
                            <option value="todo">To Do</option>
                            <option value="in-progress">In Progress</option>
                            <option value="completed">Completed</option>
                            <option value="blocked">Blocked</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Priority</label>
                        <select id="notePriority" class="form-select">
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Component / Area</label>
                    <select id="noteComponent" class="form-select">
                        <option value="platform">Platform Core</option>
                        <option value="auth">Authentication</option>
                        <option value="admin">Admin Dashboard</option>
                        <option value="assessment">Assessment System</option>
                        <option value="whitelabel">White-Label</option>
                        <option value="payments">Payments</option>
                        <option value="communications">Communications</option>
                        <option value="video">Video Conferencing</option>
                        <option value="lms">Learning Management</option>
                        <option value="experts">Expert Marketplace</option>
                        <option value="analytics">Analytics</option>
                        <option value="mobile">Mobile</option>
                        <option value="discord">Discord Bot</option>
                        <option value="agent">HumanGlue Agent</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Assignee (optional)</label>
                    <input type="text" id="noteAssignee" class="form-input" placeholder="e.g., Alex, Matt">
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-danger" id="deleteNoteBtn" onclick="deleteCurrentNote()" style="margin-right: auto; display: none;">Delete</button>
                <button class="btn btn-secondary" onclick="closeNoteModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveNote()">Save</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Settings</h3>
                <button class="modal-close" onclick="closeSettingsModal()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Project Name</label>
                    <input type="text" id="settingsProjectName" class="form-input" value="HumanGlue Platform">
                </div>
                <div class="form-group">
                    <label class="form-label">Team Members (comma separated)</label>
                    <input type="text" id="settingsTeam" class="form-input" placeholder="Alex, Matt, etc.">
                </div>
                <div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid rgba(97, 216, 254, 0.1);">
                    <h4 style="color: white; font-size: 14px; margin-bottom: 12px;">Data Management</h4>
                    <div style="display: flex; gap: 12px;">
                        <button class="btn btn-secondary" onclick="clearAllNotes()">Clear All Tasks</button>
                        <button class="btn btn-secondary" onclick="exportNotes()">Export Data</button>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeSettingsModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Hidden file input for import -->
    <input type="file" id="importFileInput" accept=".json" style="display: none;" onchange="handleImport(event)">

    <!-- Expert Advisors Modal -->
    <div id="expertsModal" class="modal-overlay">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title"> Expert Advisors - Mind Reasoner</h3>
                <button class="modal-close" onclick="closeExpertsModal()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <p style="color: #9ca3af; margin-bottom: 16px; font-size: 13px;">Consult digital twins of world-class entrepreneurs, designers, and innovators to get insights on your project.</p>
                <div id="expertsGrid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                    <!-- Experts will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Add Section Modal -->
    <div id="addSectionModal" class="modal-overlay">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title"> Add Custom Section</h3>
                <button class="modal-close" onclick="closeAddSectionModal()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Section Name *</label>
                    <input type="text" id="newSectionName" class="form-input" placeholder="e.g., API Documentation">
                </div>
                <div class="form-group">
                    <label class="form-label">Section Type</label>
                    <select id="newSectionType" class="form-select">
                        <option value="mermaid">Mermaid Diagram</option>
                        <option value="notes">Notes / Documentation</option>
                        <option value="kanban">Kanban Board</option>
                        <option value="checklist">Checklist</option>
                        <option value="timeline">Timeline</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea id="newSectionDescription" class="form-input" rows="3" placeholder="What is this section for?"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Icon Color</label>
                    <div style="display: flex; gap: 8px;">
                        <button onclick="setNewSectionColor('cyan')" class="color-btn" style="background: #61D8FE; width: 28px; height: 28px; border-radius: 50%; border: 2px solid transparent;"></button>
                        <button onclick="setNewSectionColor('green')" class="color-btn" style="background: #10B981; width: 28px; height: 28px; border-radius: 50%; border: 2px solid transparent;"></button>
                        <button onclick="setNewSectionColor('blue')" class="color-btn" style="background: #3B82F6; width: 28px; height: 28px; border-radius: 50%; border: 2px solid transparent;"></button>
                        <button onclick="setNewSectionColor('amber')" class="color-btn" style="background: #F59E0B; width: 28px; height: 28px; border-radius: 50%; border: 2px solid transparent;"></button>
                        <button onclick="setNewSectionColor('red')" class="color-btn" style="background: #EF4444; width: 28px; height: 28px; border-radius: 50%; border: 2px solid transparent;"></button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAddSectionModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveCustomSection()">Create Section</button>
            </div>
        </div>
    </div>

    <!-- Expert Consultation Modal -->
    <div id="expertConsultModal" class="modal-overlay">
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <img id="expertConsultAvatar" src="" alt="" style="width: 40px; height: 40px; border-radius: 50%;">
                    <div>
                        <h3 class="modal-title" id="expertConsultName" style="margin: 0;">Expert Name</h3>
                        <span style="font-size: 11px; color: #9ca3af;">Mind Reasoner Digital Twin</span>
                    </div>
                </div>
                <button class="modal-close" onclick="closeExpertConsultModal()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div id="expertConversation" style="max-height: 300px; overflow-y: auto; margin-bottom: 16px; padding: 12px; background: rgba(0,0,0,0.3); border-radius: 8px;">
                    <!-- Conversation history will appear here -->
                </div>
                <div class="form-group">
                    <label class="form-label">Ask about your project:</label>
                    <textarea id="expertQuery" class="form-input" rows="3" placeholder="e.g., What do you think about our approach to the white-label system?"></textarea>
                </div>
                <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 12px;">
                    <button class="btn btn-secondary" style="font-size: 11px; padding: 6px 12px;" onclick="askExpertQuickQuestion('product design')"> Product Design</button>
                    <button class="btn btn-secondary" style="font-size: 11px; padding: 6px 12px;" onclick="askExpertQuickQuestion('prioritization')"> Prioritization</button>
                    <button class="btn btn-secondary" style="font-size: 11px; padding: 6px 12px;" onclick="askExpertQuickQuestion('market fit')"> Market Fit</button>
                    <button class="btn btn-secondary" style="font-size: 11px; padding: 6px 12px;" onclick="askExpertQuickQuestion('team building')"> Team</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeExpertConsultModal()">Close</button>
                <button class="btn btn-primary" onclick="sendExpertQuery()">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin-right: 4px;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                    </svg>
                    Ask Expert
                </button>
            </div>
        </div>
    </div>

    <!-- Roadmap Item Modal -->
    <div id="roadmapModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="roadmapModalTitle">Add Timeline Item</h3>
                <button class="modal-close" onclick="closeRoadmapModal()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Feature Name *</label>
                    <input type="text" id="roadmapTitle" class="form-input" placeholder="e.g., Stripe Integration">
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label class="form-label">Quarter</label>
                        <select id="roadmapQuarter" class="form-select">
                            <option value="Q1 2026">Q1 2026</option>
                            <option value="Q2 2026">Q2 2026</option>
                            <option value="Q3 2026">Q3 2026</option>
                            <option value="Q4 2026">Q4 2026</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Duration (days)</label>
                        <input type="number" id="roadmapDuration" class="form-input" value="30" min="1" max="365">
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label class="form-label">Start Date</label>
                        <input type="date" id="roadmapStartDate" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select id="roadmapStatus" class="form-select">
                            <option value="planned">Planned</option>
                            <option value="active">Active</option>
                            <option value="done">Done</option>
                            <option value="blocked">Blocked</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea id="roadmapDescription" class="form-textarea" placeholder="What does this feature include?"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Dependencies (optional)</label>
                    <input type="text" id="roadmapDependencies" class="form-input" placeholder="e.g., Stripe account, Zoom API access">
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-danger" id="deleteRoadmapBtn" onclick="deleteRoadmapItem()" style="margin-right: auto; display: none;">Delete</button>
                <button class="btn btn-secondary" onclick="closeRoadmapModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveRoadmapItem()">Save</button>
            </div>
        </div>
    </div>

    <!-- AI Context Tooltip -->
    <div id="aiTooltip" class="ai-tooltip">
        <div class="ai-tooltip-header">
            <div class="ai-tooltip-icon">
                <svg width="18" height="18" fill="none" stroke="white" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                </svg>
            </div>
            <div>
                <div class="ai-tooltip-title" id="aiTooltipTitle">Component Name</div>
                <div class="ai-context-badge">AI Context</div>
            </div>
        </div>
        <div class="ai-tooltip-content" id="aiTooltipContent">
            Loading context...
        </div>
        <div class="ai-tooltip-actions">
            <button class="ai-tooltip-btn ai-tooltip-btn-primary" onclick="askAIAboutNode()">Ask AI</button>
            <button class="ai-tooltip-btn ai-tooltip-btn-secondary" onclick="addTaskFromNode()">Add Task</button>
            <button class="ai-tooltip-btn ai-tooltip-btn-secondary" onclick="hideAITooltip()">Close</button>
        </div>
    </div>

    <script>
        // Initialize Mermaid with comprehensive theming
        mermaid.initialize({
            startOnLoad: false,
            theme: 'dark',
            securityLevel: 'loose',
            suppressErrorRendering: false,
            themeVariables: {
                // Core colors
                primaryColor: '#1e293b',
                primaryTextColor: '#e5e7eb',
                primaryBorderColor: '#61D8FE',
                lineColor: '#61D8FE',
                secondaryColor: '#12121a',
                tertiaryColor: '#0f0f16',
                background: '#0a0a0f',
                mainBkg: '#1e293b',
                nodeBorder: '#61D8FE',
                clusterBkg: '#12121a',
                clusterBorder: '#3B82F6',
                titleColor: '#61D8FE',
                edgeLabelBackground: '#12121a',

                // Sequence diagram specific
                actorBkg: '#1e293b',
                actorBorder: '#61D8FE',
                actorTextColor: '#e5e7eb',
                actorLineColor: '#61D8FE',
                signalColor: '#61D8FE',
                signalTextColor: '#e5e7eb',
                sequenceNumberColor: '#e5e7eb',
                noteBkgColor: '#12121a',
                noteBorderColor: '#3B82F6',
                noteTextColor: '#e5e7eb',
                activationBkgColor: '#1e293b',
                activationBorderColor: '#61D8FE',

                // ER diagram specific
                entityTitleBackground: '#1e293b',
                entityBkg: '#12121a',
                entityBorder: '#61D8FE',
                labelColor: '#e5e7eb',
                attributeBackgroundColorOdd: '#12121a',
                attributeBackgroundColorEven: '#1e293b',

                // Gantt specific
                sectionBkgColor: '#12121a',
                sectionBkgColor2: '#1e293b',
                altSectionBkgColor: '#12121a',
                gridColor: '#374151',
                doneTaskBkgColor: '#10B981',
                doneTaskBorderColor: '#10B981',
                activeTaskBkgColor: '#F59E0B',
                activeTaskBorderColor: '#F59E0B',
                taskBkgColor: '#61D8FE',
                taskBorderColor: '#61D8FE',
                taskTextColor: '#0a0a0f',
                taskTextDarkColor: '#0a0a0f',
                taskTextOutsideColor: '#e5e7eb',
                todayLineColor: '#EF4444',
                critBkgColor: '#EF4444',
                critBorderColor: '#EF4444'
            },
            flowchart: {
                curve: 'basis',
                padding: 20,
                htmlLabels: true,
                useMaxWidth: false
            },
            sequence: {
                diagramMarginX: 50,
                diagramMarginY: 10,
                actorMargin: 80,
                width: 200,
                height: 65,
                boxMargin: 10,
                boxTextMargin: 5,
                noteMargin: 10,
                messageMargin: 35,
                mirrorActors: false,
                useMaxWidth: false,
                rightAngles: false,
                showSequenceNumbers: false
            },
            er: {
                useMaxWidth: false,
                entityPadding: 15,
                layoutDirection: 'TB'
            },
            gantt: {
                titleTopMargin: 25,
                barHeight: 25,
                barGap: 6,
                topPadding: 75,
                leftPadding: 150,
                gridLineStartPadding: 35,
                fontSize: 12,
                sectionFontSize: 13,
                numberSectionStyles: 4,
                axisFormat: '%b %d',
                useMaxWidth: false
            }
        });

        // Supabase Configuration
        const SUPABASE_URL = 'https://egqqdscvxvtwcdwknbnt.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVncXFkc2N2eHZ0d2Nkd2tuYm50Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2MDAxNjksImV4cCI6MjA3NTE3NjE2OX0.A2HbtCYrOrq3yoWtWVYdKbv0CduVp0XvRNWkDtqfGnw';

        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // State
        let panzoomInstance = null;
        let currentDiagram = 'platform';
        let currentFilter = 'all';
        let notes = []; // Will be loaded from Supabase
        let roadmapItems = []; // Interactive timeline items from Supabase
        let settings = JSON.parse(localStorage.getItem('hg_pm_settings') || '{"projectName": "HumanGlue Platform", "team": ""}');
        let editingNoteId = null; // UUID for editing
        let editingRoadmapId = null; // UUID for roadmap item editing
        let editingSprintTaskId = null; // UUID for sprint task editing
        let realtimeSubscription = null;
        let aiConversationHistory = []; // For contextual AI conversations
        let hoveredNode = null; // For AI tooltips
        let draggedCard = null; // For Kanban drag-drop

        // Sprint Tasks Data
        let sprintTasks = [
            { id: '1', title: 'White-Label Audit', description: 'Complete comprehensive audit of hex color values', status: 'progress', type: 'feature', points: 5, assignee: 'MS' },
            { id: '2', title: 'Discord Bot Setup', description: 'Configure discord.js bot with slash commands', status: 'progress', type: 'feature', points: 8, assignee: 'MS' },
            { id: '3', title: 'HumanGlue Agent Service', description: 'Build Express backend for MCP integration', status: 'progress', type: 'feature', points: 13, assignee: 'MS' },
            { id: '4', title: 'Branding Settings UI', description: 'Admin panel for org branding configuration', status: 'progress', type: 'enhancement', points: 5, assignee: 'MS' },
            { id: '5', title: 'Dashboard Components', description: 'Convert remaining 35 dashboard components to white-label', status: 'todo', type: 'feature', points: 8, assignee: '' },
            { id: '6', title: 'PDF Template Theming', description: 'Apply branding to PDF report templates', status: 'todo', type: 'enhancement', points: 5, assignee: '' },
            { id: '7', title: 'MindReasoner Integration', description: 'Connect personality analysis to Discord bot', status: 'todo', type: 'feature', points: 8, assignee: '' },
            { id: '8', title: 'Docker Deployment', description: 'Containerize services for DigitalOcean', status: 'todo', type: 'enhancement', points: 3, assignee: '' },
            { id: '9', title: 'Color Picker UI', description: 'Build visual color picker for admin settings', status: 'backlog', type: 'design', points: 3, assignee: '' },
            { id: '10', title: 'Logo Upload', description: 'Implement logo upload with S3 storage', status: 'backlog', type: 'feature', points: 5, assignee: '' },
            { id: '11', title: 'Hex colors conversion (22478)', description: 'Converted hardcoded hex values', status: 'done', type: 'enhancement', points: 5, assignee: 'MS' },
            { id: '12', title: 'Footer white-label', description: 'Footer component now uses BrandingContext', status: 'done', type: 'feature', points: 2, assignee: 'MS' },
            { id: '13', title: 'Login page white-label', description: 'Login/signup pages themed', status: 'done', type: 'feature', points: 3, assignee: 'MS' },
            { id: '14', title: 'Org page nav fix', description: 'Fixed navigation in organization pages', status: 'done', type: 'bug', points: 1, assignee: 'MS' },
            { id: '15', title: 'Architecture documentation', description: 'Created comprehensive system docs', status: 'done', type: 'docs', points: 3, assignee: 'MS' }
        ];

        // Mind Map Nodes Data
        let mindMapNodes = [
            { id: 'root', label: 'HumanGlue Platform', x: 400, y: 300, children: ['assessment', 'admin', 'client', 'integrations'], expanded: true, color: '#61D8FE',
              why: 'Central hub for AI maturity assessment - our core product offering', priority: 'critical', prunable: false },
            { id: 'assessment', label: 'Assessment Engine', x: 200, y: 150, children: ['vapi', 'scoring', 'reports'], expanded: true, color: '#10B981',
              why: 'REVENUE DRIVER: Core product that differentiates us from competitors', priority: 'critical', prunable: false },
            { id: 'vapi', label: 'VAPI Voice AI', x: 80, y: 80, children: [], expanded: false, color: '#F59E0B',
              why: 'Unique voice-based assessment experience, key differentiator', priority: 'high', prunable: false },
            { id: 'scoring', label: 'Scoring Algorithm', x: 200, y: 50, children: [], expanded: false, color: '#10B981',
              why: 'Proprietary LVNG framework scoring - our IP', priority: 'critical', prunable: false },
            { id: 'reports', label: 'PDF Reports', x: 320, y: 80, children: [], expanded: false, color: '#3B82F6',
              why: 'Deliverable for clients, justifies assessment pricing', priority: 'high', prunable: false },
            { id: 'admin', label: 'Admin Console', x: 600, y: 150, children: ['users', 'content', 'analytics'], expanded: true, color: '#3B82F6',
              why: 'Management interface for platform operators', priority: 'medium', prunable: false },
            { id: 'users', label: 'User Management', x: 520, y: 80, children: [], expanded: false, color: '#3B82F6',
              why: 'Essential for multi-tenant white-label system', priority: 'high', prunable: false },
            { id: 'content', label: 'Content CMS', x: 640, y: 50, children: [], expanded: false, color: '#3B82F6',
              why: 'Allows partners to customize content - CONSIDER: Could use external CMS?', priority: 'medium', prunable: true },
            { id: 'analytics', label: 'Analytics', x: 720, y: 80, children: [], expanded: false, color: '#3B82F6',
              why: 'CONSIDER: Phase 2 feature? Could defer to Q3', priority: 'low', prunable: true },
            { id: 'client', label: 'Client Portal', x: 200, y: 450, children: ['results', 'workshops', 'courses'], expanded: true, color: '#3B82F6',
              why: 'Client-facing dashboard for assessment results and learning', priority: 'high', prunable: false },
            { id: 'results', label: 'Assessment Results', x: 80, y: 520, children: [], expanded: false, color: '#10B981',
              why: 'Core client value - shows their AI maturity scores', priority: 'critical', prunable: false },
            { id: 'workshops', label: 'Workshops', x: 200, y: 550, children: [], expanded: false, color: '#F59E0B',
              why: 'REVENUE STREAM: Upsell from assessment, defer if needed', priority: 'medium', prunable: true },
            { id: 'courses', label: 'Learning', x: 320, y: 520, children: [], expanded: false, color: '#EC4899',
              why: 'FUTURE SCOPE: Consider for v2.0, not essential for MVP', priority: 'low', prunable: true },
            { id: 'integrations', label: 'Integrations', x: 600, y: 450, children: ['stripe', 'zoom', 'resend'], expanded: true, color: '#F59E0B',
              why: 'Third-party services to extend platform capabilities', priority: 'medium', prunable: false },
            { id: 'stripe', label: 'Stripe', x: 520, y: 520, children: [], expanded: false, color: '#6366F1', status: 'blocked',
              why: 'CRITICAL: Required for paid subscriptions. Blocked on setup', priority: 'critical', prunable: false },
            { id: 'zoom', label: 'Zoom', x: 640, y: 550, children: [], expanded: false, color: '#0EA5E9', status: 'blocked',
              why: 'DEFER: Can use manual scheduling initially. Phase 2', priority: 'low', prunable: true },
            { id: 'resend', label: 'Resend Email', x: 720, y: 520, children: [], expanded: false, color: '#10B981', status: 'active',
              why: 'ACTIVE: Transactional emails working. Essential', priority: 'high', prunable: false }
        ];

        // Track drag state for mind map nodes
        let mindMapDragState = { isDragging: false, nodeId: null, offsetX: 0, offsetY: 0 };

        // Diagram definitions (comprehensive)
        const diagrams = {
            platform: {
                title: 'Platform Overview',
                subtitle: 'Core architecture and data flow - click nodes to add notes',
                code: `
flowchart TB
    subgraph Client["Client Layer"]
        Browser["Browser/PWA"]
        Mobile["Mobile App (Future)"]
    end

    subgraph Frontend["Frontend - Next.js 14"]
        AppRouter["App Router"]
        Pages["Pages & Layouts"]
        Components["Component Library"]
        Contexts["Context Providers"]
    end

    subgraph Backend["Backend Services"]
        API["API Routes"]
        Auth["Auth Service"]
        Email["Resend Email"]
        SMS["Twilio SMS"]
        Voice["VAPI Voice AI"]
    end

    subgraph Database["Supabase"]
        PG[("PostgreSQL")]
        Storage["File Storage"]
        RLS["Row Level Security"]
    end

    subgraph External["External Integrations"]
        Stripe["Stripe Payments"]
        Zoom["Zoom Video"]
        Neo4j["Neo4j Graph"]
    end

    Browser --> AppRouter
    Mobile -.-> AppRouter
    AppRouter --> Pages
    Pages --> Components
    Components --> Contexts
    Contexts --> API
    API --> Auth
    API --> Email
    API --> SMS
    API --> Voice
    Auth --> PG
    API --> PG
    API --> Storage
    PG --> RLS
    API -.-> Stripe
    API -.-> Zoom
    Voice --> Neo4j

    style Browser fill:#1e293b,stroke:#61D8FE,stroke-width:2px
    style Mobile fill:#1e293b,stroke:#3B82F6,stroke-dasharray:5 5
    style AppRouter fill:#1e293b,stroke:#3B82F6,stroke-width:2px
    style PG fill:#1e293b,stroke:#10B981,stroke-width:2px
    style Voice fill:#1e293b,stroke:#F59E0B,stroke-width:2px
    style Stripe fill:#1e293b,stroke:#EF4444,stroke-dasharray:5 5
    style Zoom fill:#1e293b,stroke:#EF4444,stroke-dasharray:5 5
`
            },
            roles: {
                title: 'User Roles & Permissions',
                subtitle: '6 distinct roles with hierarchical permissions',
                code: `
flowchart TB
    subgraph Hierarchy["Role Hierarchy"]
        SA["Super Admin (Full)"]
        SAC["Super Admin (Courses)"]
        Admin["Platform Admin"]
        Instructor["Instructor"]
        Expert["Expert"]
        Client["Client"]
    end

    subgraph SuperCaps["Super Admin Capabilities"]
        AllOrgs["Manage All Orgs"]
        AllUsers["Manage All Users"]
        SystemSettings["System Settings"]
        Billing["Billing Access"]
        WhiteLabel["White-Label Config"]
    end

    subgraph AdminCaps["Admin Capabilities"]
        OrgUsers["Org User Mgmt"]
        Content["Content Mgmt"]
        Reports["Reports"]
        Workshops["Workshops"]
        Courses["Courses"]
    end

    subgraph InstructorCaps["Instructor Capabilities"]
        Teach["Teach Courses"]
        Lessons["Create Lessons"]
        Students["View Students"]
        InstAnalytics["Analytics"]
    end

    subgraph ExpertCaps["Expert Capabilities"]
        Consult["Consultations"]
        Avail["Availability"]
        Earnings["Earnings"]
        Profile["Profile"]
    end

    subgraph ClientCaps["Client Capabilities"]
        Assess["Assessments"]
        Results["Results"]
        Book["Book Workshops"]
        Learn["Courses"]
        Hire["Hire Experts"]
    end

    SA --> SuperCaps
    SA --> AdminCaps
    SAC --> Courses
    Admin --> AdminCaps
    Instructor --> InstructorCaps
    Expert --> ExpertCaps
    Client --> ClientCaps

    style SA fill:#1e293b,stroke:#10B981,stroke-width:2px
    style SAC fill:#1e293b,stroke:#10B981,stroke-width:2px
    style Admin fill:#1e293b,stroke:#3B82F6,stroke-width:2px
    style Instructor fill:#1e293b,stroke:#61D8FE,stroke-width:2px
    style Expert fill:#1e293b,stroke:#F59E0B,stroke-width:2px
    style Client fill:#1e293b,stroke:#3B82F6,stroke-width:2px
`
            },
            whitelabel: {
                title: 'White-Label System',
                subtitle: 'Organization branding customization flow',
                code: `
flowchart TB
    subgraph Entry["User Entry"]
        Login["User Login"]
    end

    subgraph Context["BrandingContext"]
        Init["Initialize Context"]
        Defaults["Load HumanGlue Defaults"]
        Override["Override with Org Branding"]
    end

    subgraph API["API Layer"]
        BrandingAPI["GET /api/organizations/:id/branding"]
        Query["SELECT FROM org_branding"]
    end

    subgraph DB["Supabase Database"]
        OrgBranding[("org_branding")]
        Config["company_name, logo, colors"]
    end

    subgraph Components["Branded Components"]
        FooterC["Footer"]
        LoginC["Login Page"]
        Charts["Charts"]
        Emails["Email Templates"]
        PDFs["PDF Reports"]
    end

    Login --> Init
    Init --> Defaults
    Defaults --> BrandingAPI
    BrandingAPI --> Query
    Query --> OrgBranding
    OrgBranding --> Config
    Config --> Override
    Override --> FooterC
    Override --> LoginC
    Override --> Charts
    Override --> Emails
    Override --> PDFs

    style Login fill:#1e293b,stroke:#61D8FE,stroke-width:2px
    style Override fill:#1e293b,stroke:#10B981,stroke-width:2px
    style OrgBranding fill:#1e293b,stroke:#3B82F6,stroke-width:2px
`
            },
            database: {
                title: 'Database Schema',
                subtitle: 'Core Supabase PostgreSQL tables and relationships',
                code: `
flowchart TB
    subgraph Core["Core Tables"]
        Orgs["organizations<br/>id, name, slug, tier"]
        Users["users<br/>id, email, full_name, org_id"]
        Roles["user_roles<br/>id, user_id, role"]
    end

    subgraph Branding["White-Label"]
        OrgBrand["org_branding<br/>company_name, logo, colors"]
    end

    subgraph Assessment["Assessment System"]
        Assess["assessments<br/>id, user_id, responses, score"]
        Responses["assessment_responses<br/>question_id, answer, metadata"]
    end

    subgraph Learning["Learning Platform"]
        Courses["courses<br/>title, instructor_id, price"]
        Workshops["workshops<br/>title, date, max_participants"]
        CourseEnroll["course_enrollments<br/>user_id, course_id"]
        WorkshopEnroll["workshop_enrollments<br/>user_id, workshop_id"]
    end

    subgraph Experts["Expert Network"]
        ExpertProf["experts<br/>specialties, hourly_rate"]
        Consults["consultations<br/>expert_id, client_id"]
    end

    Orgs --> Users
    Orgs --> OrgBrand
    Users --> Roles
    Users --> Assess
    Assess --> Responses
    Users --> CourseEnroll
    Users --> WorkshopEnroll
    Courses --> CourseEnroll
    Workshops --> WorkshopEnroll
    Users --> ExpertProf
    ExpertProf --> Consults

    style Orgs fill:#1e293b,stroke:#10B981,stroke-width:2px
    style Users fill:#1e293b,stroke:#61D8FE,stroke-width:2px
    style Assess fill:#1e293b,stroke:#F59E0B,stroke-width:2px
    style Courses fill:#1e293b,stroke:#3B82F6,stroke-width:2px
    style ExpertProf fill:#1e293b,stroke:#EF4444,stroke-width:2px
`
            },
            assessment: {
                title: 'AI Assessment Flow',
                subtitle: 'VAPI voice-powered maturity assessment system',
                code: `
flowchart TB
    subgraph Entry["Entry Points"]
        Chat["Chat Widget"]
        Direct["Direct Link"]
        CTA["CTA Button"]
    end

    subgraph Assessment["Assessment Process"]
        VAPI["VAPI Voice AI"]
        Questions["Dynamic Questions"]
        Analysis["Response Analysis"]
        Scoring["Maturity Scoring 0-10"]
    end

    subgraph Results["Results & Actions"]
        Report["PDF Report"]
        Dashboard["Results Dashboard"]
        Recs["AI Recommendations"]
        Solutions["Solution Matching"]
    end

    subgraph Storage["Data Storage"]
        Responses["assessment_responses"]
        UsersDB["users table"]
        OrgsDB["organizations table"]
    end

    subgraph Follow["Follow-up Actions"]
        Email["Email Summary"]
        Workshop["Workshop Invite"]
        Expert["Expert Match"]
    end

    Chat --> VAPI
    Direct --> VAPI
    CTA --> VAPI
    VAPI --> Questions
    Questions --> Analysis
    Analysis --> Scoring
    Scoring --> Report
    Scoring --> Dashboard
    Scoring --> Recs
    Recs --> Solutions
    Scoring --> Responses
    Responses --> UsersDB
    UsersDB --> OrgsDB
    Report --> Email
    Solutions --> Workshop
    Solutions --> Expert

    style VAPI fill:#1e293b,stroke:#F59E0B,stroke-width:2px
    style Scoring fill:#1e293b,stroke:#10B981,stroke-width:2px
    style Report fill:#1e293b,stroke:#3B82F6,stroke-width:2px
    style Email fill:#1e293b,stroke:#61D8FE,stroke-width:2px
`
            },
            roadmap: {
                title: '2026 Feature Roadmap',
                subtitle: 'Interactive timeline - click items to edit, use + to add new items',
                type: 'interactive-gantt', // Special flag for interactive rendering
                code: `
gantt
    title HumanGlue Development Roadmap 2026
    dateFormat YYYY-MM
    section Q1 2026
        Payment System           :active, pay, 2026-01, 90d
        Stripe Integration       :pay1, 2026-01, 30d
        Subscription Billing     :pay2, after pay1, 30d
        Expert Payouts          :pay3, after pay2, 30d
        Video Conferencing      :vid, 2026-01, 90d
        Zoom Integration        :vid1, 2026-01, 45d
        Workshop Rooms          :vid2, after vid1, 45d
    section Q2 2026
        Advanced LMS            :lms, 2026-04, 90d
        Course Builder          :lms1, 2026-04, 45d
        Progress Tracking       :lms2, after lms1, 25d
        Certificates            :lms3, after lms2, 20d
        Expert Marketplace      :exp, 2026-04, 90d
        Profile Pages           :exp1, 2026-04, 30d
        Booking System          :exp2, after exp1, 45d
        Reviews                 :exp3, after exp2, 15d
    section Q3 2026
        Advanced Analytics      :ana, 2026-07, 90d
        AI Insights Dashboard   :ana1, 2026-07, 45d
        Custom Report Builder   :ana2, after ana1, 30d
        ROI Tracking            :ana3, after ana2, 15d
    section Q4 2026
        Mobile Experience       :mob, 2026-10, 90d
        PWA Optimization        :mob1, 2026-10, 30d
        Push Notifications      :mob2, after mob1, 30d
        Native Apps             :mob3, after mob2, 30d
`
            },
            sprint: {
                title: 'Current Sprint',
                subtitle: 'Sprint 12  Dec 2-15, 2025  Drag cards to update status',
                type: 'kanban', // Special flag for Kanban board rendering
                code: '' // Not used for Kanban
            },
            mindmap: {
                title: 'Platform Mind Map',
                subtitle: 'Interactive system visualization - click nodes to expand, drag to reorganize',
                type: 'mindmap', // Special flag for mind map rendering
                code: ''
            },
            blockers: {
                title: 'Blockers & Risks',
                subtitle: 'Issues requiring resolution before progress',
                code: `
flowchart TB
    subgraph Blockers["Current Blockers"]
        B1["Zoom API Access"]
        B2["Stripe Account Setup"]
    end

    subgraph Impact["Blocked Features"]
        I1["Video Conferencing"]
        I2["Workshop Rooms"]
        I3["Expert Calls"]
        I4["Payment Processing"]
        I5["Subscriptions"]
        I6["Expert Payouts"]
    end

    subgraph Resolution["Resolution Steps"]
        R1["Apply for Zoom Marketplace"]
        R2["Complete business verification"]
        R3["Submit KYC documents"]
        R4["Configure webhook endpoints"]
    end

    subgraph Timeline["Expected Timeline"]
        T1["Zoom: 2-4 weeks"]
        T2["Stripe: 1-2 weeks"]
    end

    B1 --> I1 & I2 & I3
    B2 --> I4 & I5 & I6

    B1 --> R1 --> R2 --> T1
    B2 --> R3 --> R4 --> T2

    style B1 fill:#7f1d1d,stroke:#EF4444,stroke-width:2px
    style B2 fill:#7f1d1d,stroke:#EF4444,stroke-width:2px
    style I1 fill:#1e293b,stroke:#F59E0B,stroke-width:2px
    style I2 fill:#1e293b,stroke:#F59E0B,stroke-width:2px
    style I3 fill:#1e293b,stroke:#F59E0B,stroke-width:2px
    style I4 fill:#1e293b,stroke:#F59E0B,stroke-width:2px
    style I5 fill:#1e293b,stroke:#F59E0B,stroke-width:2px
    style I6 fill:#1e293b,stroke:#F59E0B,stroke-width:2px
`
            },
            integrations: {
                title: 'Third-Party Integrations',
                subtitle: 'External services and their status',
                code: `
flowchart TB
    subgraph Active["Active Integrations"]
        Supabase["Supabase - Database & Auth"]
        Resend["Resend - Email"]
        Twilio["Twilio - SMS"]
        VAPI["VAPI - Voice AI"]
        Netlify["Netlify - Hosting"]
    end

    subgraph InProgress["In Progress"]
        Neo4j["Neo4j - Knowledge Graph"]
        Discord["Discord - Bot"]
        MindReasoner["MindReasoner - AI Simulation"]
    end

    subgraph Planned["Planned"]
        Stripe["Stripe - Payments"]
        Zoom["Zoom - Video"]
        Calendly["Calendly - Scheduling"]
        Analytics["Mixpanel - Analytics"]
    end

    subgraph Platform["HumanGlue Platform"]
        Core["Core Application"]
    end

    Active --> Core
    InProgress -.-> Core
    Planned -.-> Core

    style Supabase fill:#1e293b,stroke:#10B981,stroke-width:2px
    style Resend fill:#1e293b,stroke:#10B981,stroke-width:2px
    style Twilio fill:#1e293b,stroke:#10B981,stroke-width:2px
    style VAPI fill:#1e293b,stroke:#10B981,stroke-width:2px
    style Netlify fill:#1e293b,stroke:#10B981,stroke-width:2px
    style Neo4j fill:#1e293b,stroke:#F59E0B,stroke-width:2px
    style Discord fill:#1e293b,stroke:#F59E0B,stroke-width:2px
    style MindReasoner fill:#1e293b,stroke:#F59E0B,stroke-width:2px
    style Stripe fill:#1e293b,stroke:#3B82F6,stroke-width:2px
    style Zoom fill:#1e293b,stroke:#3B82F6,stroke-width:2px
    style Calendly fill:#1e293b,stroke:#3B82F6,stroke-width:2px
    style Analytics fill:#1e293b,stroke:#3B82F6,stroke-width:2px
    style Core fill:#1e293b,stroke:#61D8FE,stroke-width:3px
`
            }
        };

        // AI Knowledge Base
        const aiKnowledge = {
            'stripe': `**Stripe Integration Plan**

1. **Account Setup** (Blocker)
   - Business verification required
   - KYC documents needed
   - Timeline: 1-2 weeks

2. **Implementation Steps**
   - Install @stripe/stripe-js
   - Create /api/webhooks/stripe endpoint
   - Set up Products & Prices
   - Implement Checkout Sessions
   - Add Customer Portal

3. **Database Changes**
   - subscriptions table
   - payments table
   - stripe_customers linking

Estimated dev time: 2-3 weeks after account approval`,

            'zoom': `**Zoom Integration Plan**

1. **Marketplace App** (Blocker)
   - Apply at marketplace.zoom.us
   - App review: 2-4 weeks
   - OAuth scopes needed

2. **Features to Implement**
   - Meeting creation API
   - Embedded meeting SDK
   - Webhook handlers
   - Recording access

3. **Use Cases**
   - Workshop video rooms
   - Expert consultation calls
   - Course live sessions

Estimated dev time: 2-3 weeks after approval`,

            'white-label': `**White-Label System Status**

**Completed:**
- BrandingContext provider
- org_branding database table
- Footer component
- Login/Signup pages
- Chart color theming
- Email template variables

**In Progress:**
- Dashboard components (35 remaining)
- PDF report templates

**Architecture:**
\`\`\`
BrandingProvider (layout.tsx)
  -> useBranding() hook
  -> CSS variables override
  -> Component rendering
\`\`\`

Progress: 65% hex colors converted`,

            'assessment': `**AI Assessment System**

**Status:** Fully Implemented

**Flow:**
1. Entry via chat widget or direct link
2. VAPI voice conversation
3. Dynamic question branching
4. Real-time analysis
5. Maturity score (0-10)
6. PDF report generation
7. AI recommendations

**Technologies:**
- VAPI for voice AI
- Claude for analysis
- React-PDF for reports
- Supabase for storage

**Data Tables:**
- assessment_responses
- assessments
- users`,

            'database': `**Supabase Database**

**Core Tables:**
- organizations (multi-tenant)
- users (profiles)
- user_roles (RBAC)
- org_branding (white-label)
- assessments
- assessment_responses
- workshops
- courses
- experts

**Security:**
- RLS on all tables
- Service role for admin APIs
- Anon role for public data

**Connection:**
\`\`\`env
NEXT_PUBLIC_SUPABASE_URL
NEXT_PUBLIC_SUPABASE_ANON_KEY
SUPABASE_SERVICE_ROLE_KEY
\`\`\``,

            'roles': `**User Role System**

**6 Roles:**
1. **super_admin_full** - Everything
2. **super_admin_courses** - Course management only
3. **admin** - Organization management
4. **instructor** - Teaching features
5. **expert** - Consultation features
6. **client** - End user features

**Implementation:**
- user_roles table
- Middleware protection
- Component-level guards
- API route validation

**Demo Accounts:**
All roles have demo accounts for testing`,

            'discord': `**Discord Bot Development**

**Status:** In Progress

**Architecture:**
- discord.js v14
- Express backend
- Neo4j knowledge graph
- MindReasoner integration

**Features Planned:**
- Community Q&A
- Assessment initiation
- Workshop notifications
- Expert matching

**Deployment:**
- Docker container
- DigitalOcean hosting
- Kubernetes ready`,

            'prd': `**HumanGlue Platform - Product Requirements Document**

**Vision:** AI-Powered Maturity Assessment & Transformation Platform

**Mission:** Help organizations measure, understand, and improve their AI readiness through expert-guided assessments, actionable insights, and continuous learning.

---

**CORE MODULES:**

**1. AI Maturity Assessment (Complete)**
- Voice-driven assessment via VAPI
- Dynamic question branching (40+ questions)
- Real-time scoring (0-10 scale)
- PDF report generation
- Personalized recommendations

**2. White-Label System (65% Complete)**
- Custom branding per organization
- Logo, colors, typography override
- Custom email templates
- Co-branded reports
- Subdomain support (future)

**3. Expert Marketplace (Planned Q2 2026)**
- Expert profiles & ratings
- Booking system
- Video consultations
- Payment splits

**4. Learning Management (Planned Q2 2026)**
- Course builder
- Progress tracking
- Certificates
- Live workshops

**5. Analytics Dashboard (Planned Q3 2026)**
- Organization trends
- Industry benchmarks
- ROI tracking
- Custom reports

---

**USER PERSONAS:**
- **CTO/CIO** - Strategic AI adoption
- **HR Leader** - Workforce readiness
- **CFO** - ROI & investment planning
- **Team Leads** - Skill gap analysis

---

**SUCCESS METRICS:**
- 1000 assessments/month
- 85% completion rate
- 4.5+ star rating
- 50% conversion to workshops`,

            'milestones': `**Project Milestones 2025-2026**

**COMPLETED **
- [Dec 2024] Core platform launch
- [Dec 2024] Assessment engine v1
- [Dec 2024] Multi-tenant architecture
- [Dec 2024] 6-role permission system
- [Dec 2024] White-label foundation

**Q1 2026 GOALS:**
- [ ] Stripe payment integration
- [ ] Expert payout system
- [ ] Zoom video integration
- [ ] Workshop scheduling
- [ ] Mobile PWA optimization

**Q2 2026 GOALS:**
- [ ] Expert marketplace launch
- [ ] Course builder MVP
- [ ] Progress tracking
- [ ] Certificate generation

**Q3 2026 GOALS:**
- [ ] AI insights dashboard
- [ ] Industry benchmarks
- [ ] Custom report builder
- [ ] API v1 for partners

**Q4 2026 GOALS:**
- [ ] Native mobile apps
- [ ] Push notifications
- [ ] Enterprise features
- [ ] SOC 2 compliance`,

            'architecture-detail': `**System Architecture Deep Dive**

**Frontend Stack:**
- Next.js 14 (App Router)
- React 18 with Server Components
- Tailwind CSS + Custom Design System
- Framer Motion animations
- React-PDF for reports

**Backend Stack:**
- Next.js API Routes (serverless)
- Supabase PostgreSQL
- Row Level Security (RLS)
- Edge Functions (Deno)

**AI/ML Stack:**
- VAPI for voice conversations
- Claude API for analysis
- MindReasoner for personality insights
- OpenAI for embeddings (future)

**Infrastructure:**
- Netlify (frontend hosting)
- Supabase (database + auth)
- Resend (transactional email)
- Twilio (SMS notifications)

**Security:**
- JWT authentication
- RLS policies on all tables
- Encrypted secrets
- CORS configuration`,

            'mindmap': `**Mind Map: HumanGlue Ecosystem**

**Core Platform**
 Assessment Engine
    VAPI Voice Interface
    Question Branching Logic
    Scoring Algorithm
    Report Generator
 User Management
    Authentication (Supabase)
    Role-Based Access
    Organization Hierarchy
    Profile Management
 White-Label System
    Branding Context
    Theme Variables
    Email Templates
    Report Customization
 Integration Layer
     VAPI (Voice AI)
     Stripe (Payments)
     Zoom (Video)
     Resend (Email)
     Twilio (SMS)

**Admin Console**
 User Management
 Organization Settings
 Content Management
 Analytics Dashboard
 System Configuration

**Client Portal**
 Assessment Journey
 Results & Reports
 Workshop Access
 Expert Booking
 Course Enrollment`,

            'default': `**HumanGlue Platform Assistant**

I'm your AI development partner with full context about the HumanGlue platform. I can help with:

** Project Info**
- "Show me the PRD" - Full product requirements
- "What are the milestones?" - Project timeline
- "Mind map" - System architecture overview

** Architecture**
- "How does [component] work?"
- "What tech stack do we use?"
- "Explain the data flow"

** Implementation**
- "What's blocking [feature]?"
- "How do I implement [feature]?"
- "Database schema for [table]"

** Status**
- "Project status" - Overall progress
- "What's in progress?"
- "What's next?"

Try clicking on any diagram node for context-aware help!`
        };

        // Comprehensive component context for AI tooltips - explains what each node does
        const componentContext = {
            // Frontend Layer
            'Browser': {
                title: 'Browser/PWA Client',
                description: 'The primary user interface delivered as a Progressive Web App (PWA). Users access HumanGlue through modern web browsers with offline capabilities, responsive design, and native-like features.',
                tech: ['Next.js 14', 'React 18', 'Tailwind CSS', 'Service Workers'],
                files: ['app/**/*.tsx', 'components/**/*.tsx'],
                status: 'active',
                relatedTasks: ['PWA optimization', 'Mobile responsive design']
            },
            'Mobile': {
                title: 'Mobile App (Future)',
                description: 'Planned native mobile applications for iOS and Android. Currently in roadmap for Q4 2026. Will share most business logic with web app through shared components.',
                tech: ['React Native', 'Expo', 'Shared UI Kit'],
                files: ['(planned)'],
                status: 'planned',
                relatedTasks: ['Native app development', 'Push notifications']
            },
            'AppRouter': {
                title: 'Next.js App Router',
                description: 'Server-side rendering and routing engine. Uses file-based routing with layouts, loading states, and error boundaries. Handles authentication redirects and protected routes.',
                tech: ['Next.js 14 App Router', 'Server Components', 'Streaming'],
                files: ['app/layout.tsx', 'app/**/page.tsx', 'middleware.ts'],
                status: 'active',
                relatedTasks: ['Route optimization', 'SEO improvements']
            },
            'Pages': {
                title: 'Pages & Layouts',
                description: 'Application pages organized by user role: admin dashboard, instructor portal, expert marketplace, and client-facing views. Each has a layout with role-specific navigation.',
                tech: ['Server Components', 'Client Components', 'Suspense'],
                files: ['app/admin/**', 'app/instructor/**', 'app/(client)/**'],
                status: 'active',
                relatedTasks: ['Dashboard components', 'Navigation fixes']
            },
            'Components': {
                title: 'Component Library',
                description: 'Reusable UI components using atomic design principles (atoms, molecules, organisms). Built with accessibility in mind and supports theming/white-labeling.',
                tech: ['React', 'Tailwind CSS', 'Radix UI', 'Framer Motion'],
                files: ['components/**/*.tsx'],
                status: 'active',
                relatedTasks: ['White-label theming', 'Component documentation']
            },
            'Contexts': {
                title: 'Context Providers',
                description: 'React contexts for global state management including auth state, branding/theming, user preferences, and real-time subscriptions.',
                tech: ['React Context', 'Custom Hooks', 'Supabase Realtime'],
                files: ['lib/context/**', 'lib/hooks/**'],
                status: 'active',
                relatedTasks: ['BrandingContext enhancement']
            },

            // Backend Layer
            'API': {
                title: 'API Routes',
                description: 'Server-side API endpoints built with Next.js Route Handlers. Handles business logic, data validation, and external service integration.',
                tech: ['Next.js Route Handlers', 'Zod validation', 'Server Actions'],
                files: ['app/api/**/*.ts'],
                status: 'active',
                relatedTasks: ['API security audit', 'Rate limiting']
            },
            'Auth': {
                title: 'Authentication Service',
                description: 'Supabase Auth integration with email/password, magic links, and OAuth providers. Manages sessions, tokens, and role-based access control.',
                tech: ['Supabase Auth', 'JWT', 'RLS Policies'],
                files: ['lib/supabase/auth.ts', 'middleware.ts'],
                status: 'active',
                relatedTasks: ['SSO integration', 'MFA support']
            },
            'Email': {
                title: 'Resend Email Service',
                description: 'Transactional email service using Resend. Handles welcome emails, notifications, assessment reports, and marketing communications with white-label support.',
                tech: ['Resend API', 'React Email', 'HTML Templates'],
                files: ['lib/email-templates.ts', 'app/api/email/**'],
                status: 'active',
                relatedTasks: ['Email template theming']
            },
            'SMS': {
                title: 'Twilio SMS Service',
                description: 'SMS notifications and two-factor authentication via Twilio. Used for workshop reminders, assessment invitations, and urgent alerts.',
                tech: ['Twilio API', '10DLC compliant'],
                files: ['lib/services/twilio.ts'],
                status: 'active',
                relatedTasks: ['SMS templates', 'Opt-in management']
            },
            'Voice': {
                title: 'VAPI Voice AI',
                description: 'Voice-powered AI assessments using VAPI. Conducts conversational maturity assessments, provides real-time analysis, and generates actionable insights.',
                tech: ['VAPI SDK', 'Claude AI', 'WebRTC'],
                files: ['components/vapi/**', 'lib/services/vapi.ts'],
                status: 'active',
                relatedTasks: ['Assessment refinement', 'Multi-language support']
            },

            // Database Layer
            'PG': {
                title: 'PostgreSQL Database',
                description: 'Core database hosted on Supabase. Contains all application data with proper indexing, constraints, and row-level security policies.',
                tech: ['PostgreSQL 15', 'Supabase', 'pgvector'],
                files: ['supabase/migrations/**'],
                status: 'active',
                relatedTasks: ['Query optimization', 'Index tuning']
            },
            'Storage': {
                title: 'File Storage',
                description: 'Supabase Storage for file uploads: profile images, course materials, assessment reports, and organization logos. Supports CDN delivery.',
                tech: ['Supabase Storage', 'S3-compatible', 'CDN'],
                files: ['lib/supabase/storage.ts'],
                status: 'active',
                relatedTasks: ['Image optimization', 'Video streaming']
            },
            'RLS': {
                title: 'Row Level Security',
                description: 'PostgreSQL RLS policies ensuring data isolation between organizations. Users can only access data within their org and permission level.',
                tech: ['PostgreSQL RLS', 'Policy Functions'],
                files: ['supabase/migrations/**'],
                status: 'active',
                relatedTasks: ['Security audit', 'Policy optimization']
            },

            // External Integrations
            'Stripe': {
                title: 'Stripe Payments (Planned)',
                description: 'Payment processing for subscriptions, course purchases, and expert payouts. Currently blocked pending business verification.',
                tech: ['Stripe Elements', 'Webhooks', 'Connect'],
                files: ['(planned) lib/services/stripe.ts'],
                status: 'blocked',
                relatedTasks: ['Account setup', 'Webhook implementation']
            },
            'Zoom': {
                title: 'Zoom Video (Planned)',
                description: 'Video conferencing integration for workshops, expert consultations, and live courses. Blocked pending Zoom Marketplace app approval.',
                tech: ['Zoom SDK', 'Meeting API', 'Webhooks'],
                files: ['(planned) lib/services/zoom.ts'],
                status: 'blocked',
                relatedTasks: ['Marketplace application', 'SDK integration']
            },
            'Neo4j': {
                title: 'Neo4j Knowledge Graph',
                description: 'Graph database for AI knowledge management. Stores relationships between concepts, companies, experts, and recommendations for intelligent querying.',
                tech: ['Neo4j Aura', 'Cypher', 'GraphQL'],
                files: ['services/humanglue-agent/**'],
                status: 'in-progress',
                relatedTasks: ['Schema design', 'Query optimization']
            },

            // User Roles
            'SA': {
                title: 'Super Admin (Full)',
                description: 'Platform owner with complete system access. Can manage all organizations, users, billing, system settings, and white-label configuration.',
                tech: ['RBAC', 'Multi-tenant'],
                files: ['app/admin/**', 'middleware.ts'],
                status: 'active',
                relatedTasks: ['Admin dashboard', 'Audit logging']
            },
            'Admin': {
                title: 'Organization Admin',
                description: 'Administrator for a single organization. Manages their org users, content, workshops, and views organization-specific analytics.',
                tech: ['RBAC', 'Org-scoped'],
                files: ['app/admin/**'],
                status: 'active',
                relatedTasks: ['Org settings UI', 'Team management']
            },
            'Instructor': {
                title: 'Instructor Role',
                description: 'Course teachers who can create and manage course content, view enrolled students, and track learning analytics.',
                tech: ['RBAC', 'Course-scoped'],
                files: ['app/instructor/**'],
                status: 'active',
                relatedTasks: ['Course builder', 'Analytics dashboard']
            },
            'Expert': {
                title: 'Expert Role',
                description: 'Consultants available for hire through the expert marketplace. Manage their profile, availability, rates, and client consultations.',
                tech: ['RBAC', 'Marketplace'],
                files: ['app/expert/**'],
                status: 'active',
                relatedTasks: ['Profile pages', 'Booking system']
            },
            'Client': {
                title: 'Client Role',
                description: 'End users who take assessments, view results, book workshops, enroll in courses, and hire experts.',
                tech: ['RBAC', 'User-scoped'],
                files: ['app/(client)/**'],
                status: 'active',
                relatedTasks: ['Dashboard improvements', 'Recommendations']
            },

            // Assessment Flow
            'VAPI': {
                title: 'VAPI Voice Assessment',
                description: 'Voice-powered conversational AI that guides users through maturity assessments. Uses Claude for natural language understanding and adaptive questioning.',
                tech: ['VAPI', 'Claude AI', 'WebRTC'],
                files: ['components/vapi/**', 'lib/services/vapi.ts'],
                status: 'active',
                relatedTasks: ['Question refinement', 'Score calibration']
            },
            'Questions': {
                title: 'Dynamic Questions',
                description: 'AI-driven question flow that adapts based on user responses. Covers 8 dimensions of AI maturity with weighted scoring.',
                tech: ['Claude AI', 'Decision Trees'],
                files: ['lib/assessment/**'],
                status: 'active',
                relatedTasks: ['New question sets', 'Industry customization']
            },
            'Scoring': {
                title: 'Maturity Scoring',
                description: 'Algorithm that calculates AI maturity score (0-10) across multiple dimensions. Generates level classifications and benchmark comparisons.',
                tech: ['Custom Algorithm', 'Benchmarking'],
                files: ['lib/assessment/scoring.ts'],
                status: 'active',
                relatedTasks: ['Score refinement', 'Industry benchmarks']
            },
            'Report': {
                title: 'PDF Report Generation',
                description: 'Automated PDF report generation with assessment results, score breakdowns, recommendations, and action items. Supports white-label branding.',
                tech: ['React-PDF', 'Server-side rendering'],
                files: ['app/api/assessments/[id]/pdf/route.ts'],
                status: 'active',
                relatedTasks: ['Template theming', 'Chart improvements']
            },

            // Generic fallback
            'default': {
                title: 'Platform Component',
                description: 'This component is part of the HumanGlue platform architecture. Click "Ask AI" for more detailed information.',
                tech: ['Next.js', 'React', 'Supabase'],
                files: ['See codebase'],
                status: 'active',
                relatedTasks: ['Documentation']
            }
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', async () => {
            // Restore UI state
            restoreSidebarState();

            // Load all data in parallel
            await Promise.all([
                loadNotesFromSupabase(),
                loadRoadmapItems()
            ]);

            // Render initial view
            loadDiagram('platform');
            renderNotes();
            renderCustomSections();
            updateStats();
            updateLastSaved();
            setupRealtimeSubscription();
        });

        // Load notes from Supabase
        async function loadNotesFromSupabase() {
            try {
                const { data, error } = await supabase
                    .from('project_notes')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                notes = data || [];
                console.log('Loaded', notes.length, 'notes from Supabase');
            } catch (err) {
                console.error('Error loading notes:', err);
                // Fallback to localStorage if Supabase fails
                notes = JSON.parse(localStorage.getItem('hg_pm_notes') || '[]');
            }
        }

        // Setup realtime subscription for collaborative updates
        function setupRealtimeSubscription() {
            realtimeSubscription = supabase
                .channel('project_notes_changes')
                .on('postgres_changes',
                    { event: '*', schema: 'public', table: 'project_notes' },
                    async (payload) => {
                        console.log('Realtime update:', payload.eventType);
                        await loadNotesFromSupabase();
                        renderNotes();
                        updateStats();
                        updateLastSaved();
                    }
                )
                .subscribe();
        }

        // Load diagram
        async function loadDiagram(name, btn) {
            currentDiagram = name;
            const diagram = diagrams[name];

            // Update nav
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            if (btn) btn.classList.add('active');

            // Update title
            document.getElementById('diagramTitle').textContent = diagram.title;
            document.getElementById('diagramSubtitle').textContent = diagram.subtitle;

            // Dispose of panzoom if switching away from mermaid
            if (panzoomInstance) {
                panzoomInstance.dispose();
                panzoomInstance = null;
            }

            // Check for special diagram types
            if (diagram.type === 'interactive-gantt') {
                renderInteractiveGantt();
                return;
            }

            if (diagram.type === 'kanban') {
                renderKanbanBoard();
                return;
            }

            if (diagram.type === 'mindmap') {
                renderMindMap();
                return;
            }

            // Render mermaid using the render API for Mermaid v10
            const container = document.getElementById('mermaidDiagram');

            try {
                // Generate unique ID for this render
                const id = 'diagram-' + Date.now();
                // Clean up the diagram code - remove leading/trailing whitespace
                const cleanCode = diagram.code.trim();

                // Use mermaid.render() to generate SVG
                const { svg } = await mermaid.render(id, cleanCode);
                container.innerHTML = svg;

                // Initialize panzoom
                if (panzoomInstance) {
                    panzoomInstance.dispose();
                }

                const wrapper = document.querySelector('.diagram-wrapper');
                panzoomInstance = panzoom(wrapper, {
                    maxZoom: 4,
                    minZoom: 0.2,
                    bounds: true,
                    boundsPadding: 0.1
                });

                panzoomInstance.on('transform', () => {
                    const transform = panzoomInstance.getTransform();
                    document.getElementById('zoomLevel').textContent = Math.round(transform.scale * 100) + '%';
                });

                // Add click handlers to nodes with AI context
                setTimeout(() => {
                    document.querySelectorAll('.node, .actor, .messageText, .cluster').forEach(node => {
                        node.style.cursor = 'pointer';
                        node.addEventListener('click', (e) => {
                            e.stopPropagation();
                            e.preventDefault();
                            const text = node.textContent?.trim() || 'Component';
                            // Extract the node ID/name for context lookup
                            const nodeId = extractNodeId(node);
                            showAITooltip(nodeId, text, e.clientX, e.clientY);
                        });
                        // Add hover effect
                        node.addEventListener('mouseenter', () => {
                            node.style.filter = 'brightness(1.2)';
                        });
                        node.addEventListener('mouseleave', () => {
                            node.style.filter = '';
                        });
                    });
                }, 300);

            } catch (err) {
                console.error('Mermaid render error:', err);
                console.error('Diagram code:', diagram.code);
                container.innerHTML = `<div style="color: #EF4444; padding: 20px; text-align: center;">
                    <p style="font-size: 18px; margin-bottom: 10px;"> Error rendering diagram</p>
                    <p style="font-size: 14px; color: #9ca3af;">${err.message || 'Unknown error'}</p>
                </div>`;
            }
        }

        // Mobile toggle functions
        function toggleMobileSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.getElementById('mobileOverlay');
            const rightPanel = document.querySelector('.right-panel');

            // Close right panel if open
            rightPanel.classList.remove('show');

            sidebar.classList.toggle('show');
            overlay.classList.toggle('show', sidebar.classList.contains('show'));
        }

        function toggleMobileRightPanel() {
            const rightPanel = document.querySelector('.right-panel');
            const overlay = document.getElementById('mobileOverlay');
            const sidebar = document.querySelector('.sidebar');

            // Close sidebar if open
            sidebar.classList.remove('show');

            rightPanel.classList.toggle('show');
            overlay.classList.toggle('show', rightPanel.classList.contains('show'));
        }

        function closeAllPanels() {
            document.querySelector('.sidebar').classList.remove('show');
            document.querySelector('.right-panel').classList.remove('show');
            document.getElementById('mobileOverlay').classList.remove('show');
        }

        // Zoom controls
        function zoomIn() {
            if (panzoomInstance) {
                panzoomInstance.smoothZoom(window.innerWidth / 2, window.innerHeight / 2, 1.3);
            }
        }

        function zoomOut() {
            if (panzoomInstance) {
                panzoomInstance.smoothZoom(window.innerWidth / 2, window.innerHeight / 2, 0.7);
            }
        }

        function resetZoom() {
            if (panzoomInstance) {
                panzoomInstance.moveTo(0, 0);
                panzoomInstance.zoomAbs(0, 0, 1);
            }
        }

        function fitToScreen() {
            resetZoom();
            if (panzoomInstance) {
                setTimeout(() => panzoomInstance.smoothZoom(window.innerWidth / 2, window.innerHeight / 2, 0.5), 100);
            }
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        // Tab switching
        function switchTab(tab, btn) {
            document.querySelectorAll('.panel-tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');

            document.getElementById('notesPanel').style.display = tab === 'notes' ? 'block' : 'none';
            document.getElementById('chatPanel').style.display = tab === 'chat' ? 'flex' : 'none';
        }

        // Note filtering
        function filterNotes(filter, btn) {
            currentFilter = filter;
            document.querySelectorAll('.task-filter').forEach(f => f.classList.remove('active'));
            btn.classList.add('active');
            renderNotes();
        }

        // Stats update
        function updateStats() {
            document.getElementById('statCompleted').textContent = notes.filter(n => n.status === 'completed').length;
            document.getElementById('statProgress').textContent = notes.filter(n => n.status === 'in-progress').length;
            document.getElementById('statTodo').textContent = notes.filter(n => n.status === 'todo').length;
            document.getElementById('statBlocked').textContent = notes.filter(n => n.status === 'blocked').length;
        }

        // Notes rendering
        function renderNotes() {
            const container = document.getElementById('notesList');
            let filteredNotes = notes;

            if (currentFilter !== 'all') {
                filteredNotes = notes.filter(n => n.status === currentFilter);
            }

            // Sort by priority (critical first), then by date
            filteredNotes.sort((a, b) => {
                const priorityOrder = { critical: 0, high: 1, medium: 2, low: 3 };
                const aPriority = priorityOrder[a.priority] ?? 2;
                const bPriority = priorityOrder[b.priority] ?? 2;
                if (aPriority !== bPriority) {
                    return aPriority - bPriority;
                }
                return new Date(b.created_at) - new Date(a.created_at);
            });

            if (filteredNotes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg width="48" height="48" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        <p>No ${currentFilter === 'all' ? 'tasks' : currentFilter.replace('_', ' ') + ' tasks'}</p>
                        <p style="font-size: 11px; margin-top: 4px;">Click a diagram node or the button below</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredNotes.map((note) => {
                return `
                <div class="note-card priority-${note.priority || 'medium'}" onclick="editNote('${note.id}')">
                    <div class="note-card-header">
                        <span class="note-card-title">${escapeHtml(note.title)}</span>
                        <span class="note-card-status status-${note.status || 'todo'}">${(note.status || 'todo').replace('_', ' ')}</span>
                    </div>
                    ${note.content ? `<div class="note-card-body">${escapeHtml(note.content).substring(0, 120)}${note.content.length > 120 ? '...' : ''}</div>` : ''}
                    <div class="note-card-meta">
                        <span style="background: rgba(97, 216, 254, 0.1); padding: 2px 6px; border-radius: 4px;">${note.node_reference || note.diagram_view || 'General'}</span>
                        ${note.created_by_name ? `<span>@${escapeHtml(note.created_by_name)}</span>` : ''}
                        <span style="margin-left: auto;">${formatDate(note.created_at)}</span>
                    </div>
                </div>
            `}).join('');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const now = new Date();
            const diff = now - date;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));

            if (days === 0) return 'Today';
            if (days === 1) return 'Yesterday';
            if (days < 7) return `${days}d ago`;
            return date.toLocaleDateString();
        }

        // Note modal
        function openNoteModal(defaultTitle = '') {
            editingNoteId = null;
            document.getElementById('noteModalTitle').textContent = 'Add Task';
            document.getElementById('noteTitle').value = defaultTitle;
            document.getElementById('noteDescription').value = '';
            document.getElementById('noteStatus').value = 'todo';
            document.getElementById('notePriority').value = 'medium';
            document.getElementById('noteComponent').value = currentDiagram;
            document.getElementById('noteAssignee').value = '';
            document.getElementById('deleteNoteBtn').style.display = 'none';
            document.getElementById('noteModal').classList.add('active');
            setTimeout(() => document.getElementById('noteTitle').focus(), 100);
        }

        function editNote(noteId) {
            editingNoteId = noteId;
            const note = notes.find(n => n.id === noteId);
            if (!note) {
                console.error('Note not found:', noteId);
                return;
            }
            document.getElementById('noteModalTitle').textContent = 'Edit Task';
            document.getElementById('noteTitle').value = note.title;
            document.getElementById('noteDescription').value = note.content || '';
            document.getElementById('noteStatus').value = note.status || 'todo';
            document.getElementById('notePriority').value = note.priority || 'medium';
            document.getElementById('noteComponent').value = note.node_reference || note.diagram_view || 'platform';
            document.getElementById('noteAssignee').value = note.created_by_name || '';
            document.getElementById('deleteNoteBtn').style.display = 'block';
            document.getElementById('noteModal').classList.add('active');
        }

        function closeNoteModal() {
            document.getElementById('noteModal').classList.remove('active');
            editingNoteId = null;
        }

        async function saveNote() {
            const title = document.getElementById('noteTitle').value.trim();
            if (!title) {
                alert('Please enter a title');
                return;
            }

            const noteData = {
                title,
                content: document.getElementById('noteDescription').value.trim(),
                status: document.getElementById('noteStatus').value,
                priority: document.getElementById('notePriority').value,
                diagram_view: currentDiagram,
                node_reference: document.getElementById('noteComponent').value,
                created_by_name: document.getElementById('noteAssignee').value.trim() || 'Anonymous'
            };

            try {
                if (editingNoteId) {
                    // Update existing note
                    const { error } = await supabase
                        .from('project_notes')
                        .update(noteData)
                        .eq('id', editingNoteId);

                    if (error) throw error;
                } else {
                    // Create new note
                    const { error } = await supabase
                        .from('project_notes')
                        .insert([noteData]);

                    if (error) throw error;
                }

                // Reload notes from Supabase
                await loadNotesFromSupabase();
                renderNotes();
                updateStats();
                updateLastSaved();
                closeNoteModal();
            } catch (err) {
                console.error('Error saving note:', err);
                alert('Error saving note. Please try again.');
            }
        }

        async function deleteCurrentNote() {
            if (editingNoteId && confirm('Delete this task?')) {
                try {
                    const { error } = await supabase
                        .from('project_notes')
                        .delete()
                        .eq('id', editingNoteId);

                    if (error) throw error;

                    await loadNotesFromSupabase();
                    renderNotes();
                    updateStats();
                    updateLastSaved();
                    closeNoteModal();
                } catch (err) {
                    console.error('Error deleting note:', err);
                    alert('Error deleting note. Please try again.');
                }
            }
        }

        // Settings
        function openSettingsModal() {
            document.getElementById('settingsProjectName').value = settings.projectName || 'HumanGlue Platform';
            document.getElementById('settingsTeam').value = settings.team || '';
            document.getElementById('settingsModal').classList.add('active');
        }

        function closeSettingsModal() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        function saveSettings() {
            settings.projectName = document.getElementById('settingsProjectName').value;
            settings.team = document.getElementById('settingsTeam').value;
            localStorage.setItem('hg_pm_settings', JSON.stringify(settings));
            closeSettingsModal();
            updateLastSaved();
        }

        function clearAllNotes() {
            if (confirm('Are you sure you want to delete ALL tasks? This cannot be undone.')) {
                notes = [];
                saveData();
                renderNotes();
                updateStats();
                closeSettingsModal();
            }
        }

        // Data persistence
        function saveData() {
            localStorage.setItem('hg_pm_notes', JSON.stringify(notes));
            updateLastSaved();
        }

        function updateLastSaved() {
            document.getElementById('lastSaved').textContent = new Date().toLocaleTimeString();
        }

        // Import/Export
        function exportNotes() {
            const data = {
                projectName: settings.projectName,
                exportDate: new Date().toISOString(),
                notes: notes,
                stats: {
                    total: notes.length,
                    completed: notes.filter(n => n.status === 'completed').length,
                    inProgress: notes.filter(n => n.status === 'in-progress').length,
                    todo: notes.filter(n => n.status === 'todo').length,
                    blocked: notes.filter(n => n.status === 'blocked').length
                }
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `humanglue-tasks-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importNotes() {
            document.getElementById('importFileInput').click();
        }

        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.notes && Array.isArray(data.notes)) {
                        if (confirm(`Import ${data.notes.length} tasks? This will add to existing tasks.`)) {
                            notes = [...data.notes, ...notes];
                            saveData();
                            renderNotes();
                            updateStats();
                            alert('Import successful!');
                        }
                    } else {
                        alert('Invalid file format');
                    }
                } catch (err) {
                    alert('Error reading file: ' + err.message);
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // Chat functionality
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            addChatMessage(message, 'user');
            input.value = '';

            const typingId = showTypingIndicator();

            setTimeout(() => {
                removeTypingIndicator(typingId);
                let response;
                if (selectedChatExpert === 'ai') {
                    response = getAIResponse(message);
                } else {
                    response = getExpertResponse(selectedChatExpert, message);
                }
                addChatMessage(response, 'assistant', true);
            }, 600 + Math.random() * 600);
        }

        function getExpertResponse(expertId, query) {
            const projectContext = `
                Project: HumanGlue Platform
                Current Phase: MVP Development
                Components: ${mindMapNodes.map(n => n.label).join(', ')}
                Critical Items: ${mindMapNodes.filter(n => n.priority === 'critical').map(n => n.label).join(', ')}
                Prunable: ${mindMapNodes.filter(n => n.prunable).map(n => n.label).join(', ') || 'None identified'}
                Sprint Tasks: ${sprintTasks.filter(t => t.status === 'progress').map(t => t.title).join(', ')}
            `;

            const expertPersonalities = {
                'steve-jobs': {
                    name: 'Steve Jobs',
                    icon: '',
                    style: 'Direct, challenging, focused on user experience and simplicity.',
                    responses: {
                        default: `Focus. That's what separates great products from merely good ones. Looking at your project - ${mindMapNodes.length} components is a lot. What's the ONE thing that makes HumanGlue irreplaceable?

The question isn't whether you CAN build all of this. It's whether you SHOULD. Start with what matters most to your users. Make it insanely great. Then, and only then, think about adding more.

What does your customer see when they first use HumanGlue? Is it magical? If not, nothing else matters.`,
                        scope: `You're asking about scope? Good. Most founders don't ask that question until it's too late.

Here's my philosophy: Do fewer things better. I see you have components marked as prunable. Why are they still there? Cut them. Today.

The critical path is: Assessment Engine  Reports  Client Portal. Everything else is noise until those are perfect. Are they perfect?`,
                        design: `Design isn't just how it looks - it's how it works. Every pixel, every interaction, every moment of friction... they all matter.

Look at your mind map. Is there elegance in this architecture? Or is it complexity hiding behind a diagram? The best designs feel inevitable, as if they couldn't have been designed any other way.

Show me one user flow. I'll tell you where you're overthinking it.`
                    }
                },
                'paul-graham': {
                    name: 'Paul Graham',
                    icon: '',
                    style: 'Analytical, focused on startup strategy and product-market fit.',
                    responses: {
                        default: `The question I always ask founders: Are you building something people want?

Looking at HumanGlue, your Assessment Engine seems to be the core value prop. But here's what concerns me - how many paying customers do you have RIGHT NOW?

The best indicator of product-market fit isn't a beautiful architecture diagram. It's customers pulling the product out of your hands.

Talk to 10 potential customers this week. Not to sell them - to learn. What exact problem keeps them up at night? Is it really "AI maturity assessment"?`,
                        metrics: `Metrics are the mirror that shows you what's actually happening.

For HumanGlue at your stage, I'd focus on:
1. **Weekly Active Users** - Are people coming back?
2. **Time to First Value** - How fast can someone complete an assessment?
3. **Conversion Rate** - Free  Paid. This is your PMF indicator.
4. **NPS or equivalent** - Would they recommend you?

What are these numbers today? If you don't know, that's problem #1.`,
                        fundraising: `Don't think about fundraising. Think about growth.

Investors fund traction, not ideas. With your current progress, focus on getting to 10 paying customers. Then 50. Then 200.

At each milestone, you'll have more leverage. And here's the counterintuitive part: the less you need money, the easier it is to raise.

What's your current MRR?`
                    }
                },
                'jony-ive': {
                    name: 'Jony Ive',
                    icon: '',
                    style: 'Thoughtful, focused on craftsmanship and emotional design.',
                    responses: {
                        default: `When I look at a product, I think about the human experience. Not the features, not the technology - the moment of use.

Your HumanGlue platform... what does it feel like to use it? Is there joy in the interaction? Does it respect the user's time and intelligence?

I see many components in your architecture. Each one represents cognitive load for your users. The art isn't in what you add - it's in what you leave out while still achieving the essential purpose.

What's the emotional journey you want users to have?`,
                        simplicity: `True simplicity isn't the absence of complexity - it's the conquest of it.

Your mind map shows interconnected systems. That's fine technically. But the user should never feel that complexity. They should only feel clarity.

Consider: What if HumanGlue had only ONE screen? What would it show? Start there. Then add only what's absolutely necessary.

The goal isn't minimal features. It's minimal friction.`,
                        brand: `A brand is a promise. It's what people feel when they think of you.

HumanGlue - the name itself suggests connection, humanity in technology. But does your product deliver on that promise?

Every color choice, every transition, every word of copy... they should all reinforce the same feeling. What is that feeling for HumanGlue?

I'd suggest: Warmth. Clarity. Confidence. Does your current design evoke these?`
                    }
                }
            };

            const expert = expertPersonalities[expertId];
            if (!expert) return getAIResponse(query);

            // Match query to response type
            const lowerQuery = query.toLowerCase();
            let responseType = 'default';
            if (lowerQuery.includes('scope') || lowerQuery.includes('prune') || lowerQuery.includes('cut')) {
                responseType = 'scope';
            } else if (lowerQuery.includes('design') || lowerQuery.includes('ui') || lowerQuery.includes('ux')) {
                responseType = 'design';
            } else if (lowerQuery.includes('metric') || lowerQuery.includes('kpi') || lowerQuery.includes('measure')) {
                responseType = 'metrics';
            } else if (lowerQuery.includes('raise') || lowerQuery.includes('funding') || lowerQuery.includes('investor')) {
                responseType = 'fundraising';
            } else if (lowerQuery.includes('simple') || lowerQuery.includes('minimal') || lowerQuery.includes('clean')) {
                responseType = 'simplicity';
            } else if (lowerQuery.includes('brand') || lowerQuery.includes('identity') || lowerQuery.includes('feel')) {
                responseType = 'brand';
            }

            const response = expert.responses[responseType] || expert.responses.default;

            return `<strong style="color: var(--hg-cyan);">${expert.icon} ${expert.name}</strong>
<br><br>
${response}
<br><br>
<div style="font-size: 11px; color: var(--text-muted); border-top: 1px solid var(--border-subtle); padding-top: 8px; margin-top: 8px;">
    <em>Powered by Mind Reasoner</em>
</div>`;
        }

        // Helper for hot buttons
        function askAI(topic) {
            document.getElementById('chatInput').value = topic;
            sendMessage();
            // Switch to chat tab if not active
            switchTab('chat', document.querySelectorAll('.panel-tab')[1]);
        }

        // Create structured action card HTML
        function createActionCard(icon, iconClass, title, content, actions = []) {
            const actionBtns = actions.map(a =>
                `<button class="ai-response-btn ${a.primary ? 'primary' : 'secondary'}" onclick="${a.action}">${a.label}</button>`
            ).join('');

            return `<div class="ai-action-card">
                <div class="ai-action-header">
                    <div class="ai-action-icon ${iconClass}">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            ${icon}
                        </svg>
                    </div>
                    <div class="ai-action-title">${title}</div>
                </div>
                <div class="ai-action-content">${content}</div>
                ${actions.length ? `<div class="ai-response-actions">${actionBtns}</div>` : ''}
            </div>`;
        }

        function addChatMessage(text, role, isStructured = false) {
            const container = document.getElementById('chatMessages');
            const div = document.createElement('div');
            div.className = `chat-message ${role}`;

            // Convert markdown-like formatting
            let html = text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/`([^`]+)`/g, '<code style="background: rgba(97,216,254,0.1); padding: 2px 6px; border-radius: 4px;">$1</code>')
                .replace(/```([\s\S]*?)```/g, '<pre style="background: rgba(0,0,0,0.3); padding: 12px; border-radius: 8px; margin: 8px 0; overflow-x: auto; font-size: 12px;">$1</pre>')
                .replace(/\n/g, '<br>');

            // If structured, handle action cards (already HTML)
            if (isStructured && text.includes('ai-action-card')) {
                html = text;
            }

            div.innerHTML = `<div class="chat-message-bubble">${html}</div>`;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function showTypingIndicator() {
            const container = document.getElementById('chatMessages');
            const div = document.createElement('div');
            div.className = 'chat-message assistant';
            div.id = 'typing-' + Date.now();
            div.innerHTML = `
                <div class="chat-message-bubble">
                    <div class="typing-indicator">
                        <span class="typing-dot"></span>
                        <span class="typing-dot"></span>
                        <span class="typing-dot"></span>
                    </div>
                </div>
            `;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
            return div.id;
        }

        function removeTypingIndicator(id) {
            const el = document.getElementById(id);
            if (el) el.remove();
        }

        // Get comprehensive AI response with structured output
        function getAIResponse(message) {
            const lower = message.toLowerCase();
            const diagram = diagrams[currentDiagram];

            // PROJECT STATUS - Comprehensive overview
            if (lower.includes('project status') || lower.includes('status') || lower.includes('overview')) {
                const todoCount = notes.filter(n => n.status === 'todo').length;
                const inProgressCount = notes.filter(n => n.status === 'in-progress').length;
                const completedCount = notes.filter(n => n.status === 'completed').length;
                const blockedCount = notes.filter(n => n.status === 'blocked').length;

                return `<strong style="color: var(--hg-cyan);"> HumanGlue Project Status</strong>

${createActionCard(
    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>',
    'status',
    'Task Summary',
    `<ul style="margin:0;padding-left:16px;">
        <li><strong>${todoCount}</strong> tasks pending</li>
        <li><strong>${inProgressCount}</strong> in progress</li>
        <li><strong>${completedCount}</strong> completed</li>
        <li><strong>${blockedCount}</strong> blocked</li>
    </ul>`,
    [{label: 'Add Task', action: 'openNoteModal()', primary: true}, {label: 'View Tasks', action: "switchTab('tasks', document.querySelector('.panel-tab'))"}]
)}

${createActionCard(
    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>',
    'info',
    'Active Components',
    `<ul style="margin:0;padding-left:16px;">
        <li> Authentication & RBAC</li>
        <li> White-label branding (65%)</li>
        <li> AI Assessment (VAPI)</li>
        <li> Discord Bot (development)</li>
        <li> Payments (awaiting Stripe)</li>
        <li> Video (awaiting Zoom)</li>
    </ul>`,
    [{label: 'View Roadmap', action: "loadDiagram('roadmap', this)"}]
)}`;
            }

            // BLOCKERS - Show current blockers
            if (lower.includes('blocker') || lower.includes('blocked') || lower.includes('issue') || lower.includes('problem')) {
                const blockedTasks = notes.filter(n => n.status === 'blocked');
                const blockerList = blockedTasks.length > 0
                    ? blockedTasks.map(t => `<li>${t.title}</li>`).join('')
                    : '<li>No blocked tasks currently</li>';

                return `<strong style="color: var(--hg-red);"> Current Blockers</strong>

${createActionCard(
    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>',
    'blocker',
    'External Blockers',
    `<ul style="margin:0;padding-left:16px;">
        <li><strong>Stripe:</strong> Business verification pending (1-2 weeks)</li>
        <li><strong>Zoom:</strong> Marketplace app review (2-4 weeks)</li>
    </ul>`,
    [{label: 'Stripe Setup', action: "askAI('stripe')"}, {label: 'Zoom Setup', action: "askAI('zoom')"}]
)}

${createActionCard(
    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>',
    'task',
    'Blocked Tasks',
    `<ul style="margin:0;padding-left:16px;">${blockerList}</ul>`,
    blockedTasks.length > 0 ? [{label: 'View Blocked', action: "filterNotes('blocked')"}] : []
)}`;
            }

            // NEXT STEPS - Prioritized next actions
            if (lower.includes('next') || lower.includes('priority') || lower.includes('should') || lower.includes('todo')) {
                return `<strong style="color: var(--hg-green);"> Recommended Next Steps</strong>

${createActionCard(
    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>',
    'status',
    'Immediate Priority',
    `<ol style="margin:0;padding-left:16px;">
        <li><strong>Complete white-label migration</strong> - 35 components remaining</li>
        <li><strong>Finish Discord bot</strong> - Community engagement ready</li>
        <li><strong>Start Stripe verification</strong> - Submit documents now</li>
    </ol>`,
    [{label: 'Add to Tasks', action: "openNoteModal('Complete white-label migration')", primary: true}]
)}

${createActionCard(
    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>',
    'info',
    'This Week',
    `<ul style="margin:0;padding-left:16px;">
        <li>Apply for Zoom Marketplace access</li>
        <li>Set up expert profile pages</li>
        <li>Implement push notifications</li>
        <li>Write test coverage for API routes</li>
    </ul>`,
    [{label: 'View Roadmap', action: "loadDiagram('roadmap', this)"}]
)}`;
            }

            // CURRENT DIAGRAM context
            if (lower.includes('current diagram') || lower.includes('this view') || lower.includes('this page')) {
                return `<strong style="color: var(--hg-cyan);"> Current View: ${diagram.title}</strong>

${createActionCard(
    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"/>',
    'info',
    diagram.title,
    `<p style="margin:0 0 8px 0;">${diagram.subtitle}</p>
    <p style="margin:0;font-size:11px;color:#6b7280;">Click on any node in the diagram to see detailed context and related tasks. Use the AI tooltip to ask questions or add tasks directly from any component.</p>`,
    [{label: 'Add Note for View', action: `openNoteModal('Task for ${diagram.title}')`, primary: true}]
)}

<p style="font-size:12px;color:#9ca3af;margin-top:8px;"> <strong>Tip:</strong> Click any node in the diagram for AI-powered context!</p>`;
            }

            // TASKS summary
            if (lower.includes('task') || lower.includes('my task') || lower.includes('work')) {
                const highPriority = notes.filter(n => n.priority === 'high' && n.status !== 'completed');
                const inProgress = notes.filter(n => n.status === 'in-progress');

                return `<strong style="color: var(--hg-blue);"> Task Overview</strong>

${createActionCard(
    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>',
    'warning',
    `High Priority (${highPriority.length})`,
    highPriority.length > 0
        ? `<ul style="margin:0;padding-left:16px;">${highPriority.slice(0, 3).map(t => `<li>${t.title}</li>`).join('')}</ul>`
        : `<p style="margin:0;">No high priority tasks</p>`,
    [{label: 'View High Priority', action: "filterNotes('high')", primary: true}]
)}

${createActionCard(
    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>',
    'task',
    `In Progress (${inProgress.length})`,
    inProgress.length > 0
        ? `<ul style="margin:0;padding-left:16px;">${inProgress.slice(0, 3).map(t => `<li>${t.title}</li>`).join('')}</ul>`
        : `<p style="margin:0;">No tasks in progress</p>`,
    [{label: 'Add Task', action: 'openNoteModal()', primary: true}, {label: 'View All', action: "switchTab('tasks', document.querySelector('.panel-tab'))"}]
)}`;
            }

            // ARCHITECTURE overview
            if (lower.includes('architecture') || lower.includes('structure') || lower.includes('stack') || lower.includes('tech')) {
                return `<strong style="color: var(--hg-cyan);"> Platform Architecture</strong>

${createActionCard(
    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2"/>',
    'info',
    'Tech Stack',
    `<ul style="margin:0;padding-left:16px;">
        <li><strong>Frontend:</strong> Next.js 14, React 18, Tailwind CSS</li>
        <li><strong>Backend:</strong> Next.js API Routes, Supabase</li>
        <li><strong>Database:</strong> PostgreSQL (Supabase), Neo4j</li>
        <li><strong>AI:</strong> VAPI Voice, Claude, MindReasoner</li>
        <li><strong>Comms:</strong> Resend, Twilio, Discord.js</li>
    </ul>`,
    [{label: 'Platform View', action: "loadDiagram('platform', this)", primary: true}]
)}

${createActionCard(
    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"/>',
    'status',
    'Key Integrations',
    `<ul style="margin:0;padding-left:16px;">
        <li> Supabase Auth & Database</li>
        <li> Resend Email</li>
        <li> Twilio SMS</li>
        <li> VAPI Voice AI</li>
        <li> Stripe Payments</li>
        <li> Zoom Video</li>
    </ul>`,
    [{label: 'Database Schema', action: "loadDiagram('database', this)"}]
)}`;
            }

            // FILES - Codebase structure
            if (lower.includes('file') || lower.includes('folder') || lower.includes('code') || lower.includes('directory')) {
                return `<strong style="color: var(--hg-blue);"> Codebase Structure</strong>

${createActionCard(
    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>',
    'info',
    'Key Directories',
    `<ul style="margin:0;padding-left:16px;font-family:monospace;font-size:11px;">
        <li><strong>app/</strong> - Next.js pages & layouts</li>
        <li><strong>components/</strong> - Atomic design UI</li>
        <li><strong>lib/</strong> - Services & utilities</li>
        <li><strong>services/</strong> - Discord bot, agents</li>
        <li><strong>supabase/</strong> - Migrations</li>
    </ul>`
)}

${createActionCard(
    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>',
    'task',
    'Important Files',
    `<ul style="margin:0;padding-left:16px;font-family:monospace;font-size:11px;">
        <li><code>middleware.ts</code> - Auth protection</li>
        <li><code>lib/branding/BrandingContext.tsx</code> - White-label</li>
        <li><code>lib/supabase/client.ts</code> - DB client</li>
        <li><code>app/api/**</code> - API routes</li>
    </ul>`
)}`;
            }

            // Check if asking about a specific component from the current context
            if (hoveredNode && (lower.includes('this') || lower.includes('more') || lower.includes('detail') || lower.includes('explain'))) {
                const context = getComponentContext(hoveredNode);
                return `<strong style="color: var(--hg-cyan);">${context.title}</strong>

${createActionCard(
    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>',
    context.status === 'active' ? 'status' : context.status === 'blocked' ? 'blocker' : 'info',
    'Overview',
    `<p style="margin:0 0 8px 0;">${context.description}</p>
    <p style="margin:0;font-size:11px;"><strong>Tech:</strong> ${context.tech.join(', ')}</p>
    <p style="margin:0;font-size:11px;"><strong>Files:</strong> <code>${context.files[0]}</code></p>`,
    [{label: 'Add Task', action: `openNoteModal('Work on ${context.title}')`, primary: true}]
)}`;
            }

            // PRD - Product Requirements Document
            if (lower.includes('prd') || lower.includes('requirements') || lower.includes('product document') || lower.includes('product req')) {
                return `<strong style="color: var(--hg-blue);"> Product Requirements Document</strong>

${createActionCard(
    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>',
    'info',
    'Product Vision',
    `<p style="margin:0;"><strong>Vision:</strong> AI-Powered Maturity Assessment & Transformation Platform</p>
    <p style="margin:8px 0 0 0;font-size:11px;">Help organizations measure, understand, and improve their AI readiness through expert-guided assessments, actionable insights, and continuous learning.</p>`
)}

${createActionCard(
    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"/>',
    'task',
    'Core Modules',
    `<ul style="margin:0;padding-left:16px;font-size:11px;">
        <li><strong>Assessment Engine</strong>  Complete</li>
        <li><strong>White-Label System</strong>  65%</li>
        <li><strong>Expert Marketplace</strong>  Q2 2026</li>
        <li><strong>Learning Management</strong>  Q2 2026</li>
        <li><strong>Analytics Dashboard</strong>  Q3 2026</li>
    </ul>`,
    [{label: 'View Milestones', action: "askAI('milestones')", primary: true}, {label: 'View Roadmap', action: "loadDiagram('roadmap', this)"}]
)}`;
            }

            // MILESTONES - Project milestones
            if (lower.includes('milestone') || lower.includes('timeline') || lower.includes('goal') || lower.includes('quarter')) {
                return `<strong style="color: var(--hg-green);"> Project Milestones</strong>

${createActionCard(
    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>',
    'status',
    'Completed ',
    `<ul style="margin:0;padding-left:16px;font-size:11px;">
        <li>[Dec 2024] Core platform launch</li>
        <li>[Dec 2024] Assessment engine v1</li>
        <li>[Dec 2024] Multi-tenant architecture</li>
        <li>[Dec 2024] 6-role permission system</li>
    </ul>`
)}

${createActionCard(
    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>',
    'warning',
    'Q1 2026 Goals',
    `<ul style="margin:0;padding-left:16px;font-size:11px;">
        <li>[ ] Stripe payment integration</li>
        <li>[ ] Expert payout system</li>
        <li>[ ] Zoom video integration</li>
        <li>[ ] Workshop scheduling</li>
    </ul>`,
    [{label: 'View Roadmap', action: "loadDiagram('roadmap', this)", primary: true}]
)}`;
            }

            // MINDMAP - System visualization
            if (lower.includes('mind') || lower.includes('map') || lower.includes('visualization') || lower.includes('ecosystem')) {
                return `<strong style="color: var(--hg-cyan);"> Platform Mind Map</strong>

${createActionCard(
    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"/>',
    'info',
    'Interactive Visualization',
    `<p style="margin:0;">The Mind Map view shows the HumanGlue platform ecosystem as an interactive, expandable node graph.</p>
    <ul style="margin:8px 0 0 0;padding-left:16px;font-size:11px;">
        <li>Click nodes to expand/collapse children</li>
        <li>Add new nodes from the palette</li>
        <li>Blocked integrations shown with </li>
    </ul>`,
    [{label: 'Open Mind Map', action: "loadDiagram('mindmap', this)", primary: true}]
)}`;
            }

            // SPRINT - Kanban board
            if (lower.includes('sprint') || lower.includes('kanban') || lower.includes('board')) {
                const totalPoints = sprintTasks.reduce((sum, t) => sum + t.points, 0);
                const donePoints = sprintTasks.filter(t => t.status === 'done').reduce((sum, t) => sum + t.points, 0);
                const progressPercent = Math.round((donePoints / totalPoints) * 100);

                return `<strong style="color: var(--hg-cyan);"> Sprint 12 Status</strong>

${createActionCard(
    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>',
    'status',
    'Sprint Progress',
    `<p style="margin:0;"><strong>${progressPercent}%</strong> complete (${donePoints}/${totalPoints} story points)</p>
    <ul style="margin:8px 0 0 0;padding-left:16px;font-size:11px;">
        <li><strong>${sprintTasks.filter(t => t.status === 'progress').length}</strong> tasks in progress</li>
        <li><strong>${sprintTasks.filter(t => t.status === 'done').length}</strong> tasks completed</li>
        <li><strong>${sprintTasks.filter(t => t.status === 'todo' || t.status === 'backlog').length}</strong> tasks remaining</li>
    </ul>`,
    [{label: 'Open Sprint Board', action: "loadDiagram('sprint', this)", primary: true}]
)}`;
            }

            // Standard knowledge base responses
            if (lower.includes('stripe') || lower.includes('payment')) return aiKnowledge.stripe;
            if (lower.includes('zoom') || lower.includes('video')) return aiKnowledge.zoom;
            if (lower.includes('white') || lower.includes('label') || lower.includes('brand')) return aiKnowledge['white-label'];
            if (lower.includes('assess')) return aiKnowledge.assessment;
            if (lower.includes('database') || lower.includes('schema') || lower.includes('table') || lower.includes('supabase')) return aiKnowledge.database;
            if (lower.includes('role') || lower.includes('permission') || lower.includes('admin')) return aiKnowledge.roles;
            if (lower.includes('discord') || lower.includes('bot')) return aiKnowledge.discord;

            // Default with action cards
            return `<strong style="color: var(--hg-cyan);"> HumanGlue AI Assistant</strong>

${createActionCard(
    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>',
    'info',
    'I can help with',
    `<ul style="margin:0;padding-left:16px;">
        <li><strong>Architecture</strong> - Platform design & data flow</li>
        <li><strong>Features</strong> - Implementation details</li>
        <li><strong>Integrations</strong> - Stripe, Zoom, VAPI, etc.</li>
        <li><strong>Database</strong> - Schema & queries</li>
        <li><strong>Tasks</strong> - Planning & tracking</li>
    </ul>`,
    [{label: 'Project Status', action: "askAI('project status')", primary: true}, {label: 'Next Steps', action: "askAI('next steps')"}]
)}

<p style="font-size:12px;color:#6b7280;margin-top:8px;">Use the quick buttons below or click on diagram nodes for context!</p>`;
        }

        // Filter notes helper for AI actions
        function filterNotes(filter) {
            currentFilter = filter;
            renderNotes();
            switchTab('tasks', document.querySelector('.panel-tab'));
        }

        // ==========================================
        // AI TOOLTIP FUNCTIONS
        // ==========================================

        // Extract node ID from Mermaid SVG element
        function extractNodeId(node) {
            // Try to get ID from element or parent
            const id = node.id || node.closest('[id]')?.id || '';
            // Extract the meaningful part (e.g., "flowchart-Browser-123" -> "Browser")
            const match = id.match(/flowchart-(\w+)-\d+/) || id.match(/(\w+)/);
            if (match) return match[1];
            // Fallback to text content
            const text = node.textContent?.trim() || '';
            // Try to match known component names
            const knownComponents = Object.keys(componentContext);
            for (const comp of knownComponents) {
                if (text.toLowerCase().includes(comp.toLowerCase())) {
                    return comp;
                }
            }
            return text.split(/[\s\n]/)[0]; // First word
        }

        // Get component context for a node
        function getComponentContext(nodeId) {
            // Try exact match first
            if (componentContext[nodeId]) return componentContext[nodeId];

            // Try case-insensitive match
            const lowerNodeId = nodeId.toLowerCase();
            for (const [key, value] of Object.entries(componentContext)) {
                if (key.toLowerCase() === lowerNodeId) return value;
            }

            // Try partial match in title
            for (const [key, value] of Object.entries(componentContext)) {
                if (value.title.toLowerCase().includes(lowerNodeId)) return value;
            }

            // Return default with custom title
            return {
                ...componentContext.default,
                title: nodeId
            };
        }

        // Show AI tooltip with context
        function showAITooltip(nodeId, text, x, y) {
            hoveredNode = nodeId;
            const context = getComponentContext(nodeId);
            const tooltip = document.getElementById('aiTooltip');

            // Update content
            document.getElementById('aiTooltipTitle').textContent = context.title;

            const statusColors = {
                'active': '#10B981',
                'blocked': '#EF4444',
                'planned': '#3B82F6',
                'in-progress': '#F59E0B'
            };
            const statusText = {
                'active': ' Active',
                'blocked': ' Blocked',
                'planned': ' Planned',
                'in-progress': ' In Progress'
            };

            document.getElementById('aiTooltipContent').innerHTML = `
                <p style="margin-bottom: 12px;">${context.description}</p>
                <div style="display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 8px;">
                    ${context.tech.map(t => `<span style="background: rgba(97, 216, 254, 0.1); padding: 2px 8px; border-radius: 4px; font-size: 11px; color: var(--hg-cyan);">${t}</span>`).join('')}
                </div>
                <div style="font-size: 12px; color: #6b7280;">
                    <span style="color: ${statusColors[context.status] || '#9ca3af'}">${statusText[context.status] || context.status}</span>
                     Files: <code style="background: rgba(0,0,0,0.3); padding: 1px 4px; border-radius: 3px;">${context.files[0]}</code>
                </div>
            `;

            // Position tooltip
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;
            const tooltipWidth = 400;
            const tooltipHeight = 250;

            let left = x + 10;
            let top = y + 10;

            // Prevent going off right edge
            if (left + tooltipWidth > viewportWidth - 20) {
                left = x - tooltipWidth - 10;
            }
            // Prevent going off bottom edge
            if (top + tooltipHeight > viewportHeight - 20) {
                top = y - tooltipHeight - 10;
            }

            tooltip.style.left = `${Math.max(10, left)}px`;
            tooltip.style.top = `${Math.max(10, top)}px`;
            tooltip.classList.add('visible');
        }

        function hideAITooltip() {
            document.getElementById('aiTooltip').classList.remove('visible');
        }

        // Ask AI about the current node
        function askAIAboutNode() {
            hideAITooltip();
            // Switch to AI chat tab
            switchTab('chat', document.querySelectorAll('.panel-tab')[1]);
            // Pre-fill with question about the node
            if (hoveredNode) {
                const context = getComponentContext(hoveredNode);
                document.getElementById('chatInput').value = `Tell me more about ${context.title}`;
                document.getElementById('chatInput').focus();
            }
        }

        // Add a task from the current node context
        function addTaskFromNode() {
            hideAITooltip();
            if (hoveredNode) {
                const context = getComponentContext(hoveredNode);
                openNoteModal(context.relatedTasks[0] || `Work on ${context.title}`);
                // Pre-fill component
                setTimeout(() => {
                    document.getElementById('noteDescription').value = `Related to: ${context.title}\n\n${context.description.substring(0, 150)}...`;
                }, 100);
            }
        }

        // Close tooltip when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.ai-tooltip') && !e.target.closest('.node') && !e.target.closest('.cluster')) {
                hideAITooltip();
            }
        });

        // ==========================================
        // ROADMAP MODAL FUNCTIONS
        // ==========================================

        function openRoadmapModal(itemId = null) {
            editingRoadmapId = itemId;

            if (itemId) {
                const item = roadmapItems.find(i => i.id === itemId);
                if (item) {
                    document.getElementById('roadmapModalTitle').textContent = 'Edit Timeline Item';
                    document.getElementById('roadmapTitle').value = item.title;
                    document.getElementById('roadmapQuarter').value = item.quarter;
                    document.getElementById('roadmapDuration').value = item.duration;
                    document.getElementById('roadmapStartDate').value = item.start_date;
                    document.getElementById('roadmapStatus').value = item.status;
                    document.getElementById('roadmapDescription').value = item.description || '';
                    document.getElementById('roadmapDependencies').value = item.dependencies || '';
                    document.getElementById('deleteRoadmapBtn').style.display = 'block';
                }
            } else {
                document.getElementById('roadmapModalTitle').textContent = 'Add Timeline Item';
                document.getElementById('roadmapTitle').value = '';
                document.getElementById('roadmapQuarter').value = 'Q1 2026';
                document.getElementById('roadmapDuration').value = 30;
                document.getElementById('roadmapStartDate').value = '2026-01-01';
                document.getElementById('roadmapStatus').value = 'planned';
                document.getElementById('roadmapDescription').value = '';
                document.getElementById('roadmapDependencies').value = '';
                document.getElementById('deleteRoadmapBtn').style.display = 'none';
            }

            document.getElementById('roadmapModal').classList.add('active');
        }

        function closeRoadmapModal() {
            document.getElementById('roadmapModal').classList.remove('active');
            editingRoadmapId = null;
        }

        async function saveRoadmapItem() {
            const title = document.getElementById('roadmapTitle').value.trim();
            if (!title) {
                alert('Please enter a feature name');
                return;
            }

            const itemData = {
                title,
                quarter: document.getElementById('roadmapQuarter').value,
                duration: parseInt(document.getElementById('roadmapDuration').value) || 30,
                start_date: document.getElementById('roadmapStartDate').value,
                status: document.getElementById('roadmapStatus').value,
                description: document.getElementById('roadmapDescription').value.trim(),
                dependencies: document.getElementById('roadmapDependencies').value.trim()
            };

            try {
                if (editingRoadmapId) {
                    const { error } = await supabase
                        .from('roadmap_items')
                        .update(itemData)
                        .eq('id', editingRoadmapId);
                    if (error) throw error;
                } else {
                    const { error } = await supabase
                        .from('roadmap_items')
                        .insert([itemData]);
                    if (error) throw error;
                }

                await loadRoadmapItems();
                if (currentDiagram === 'roadmap') {
                    renderInteractiveGantt();
                }
                closeRoadmapModal();
            } catch (err) {
                console.error('Error saving roadmap item:', err);
                // Fallback to local storage for demo
                if (editingRoadmapId) {
                    const index = roadmapItems.findIndex(i => i.id === editingRoadmapId);
                    if (index >= 0) {
                        roadmapItems[index] = { ...roadmapItems[index], ...itemData };
                    }
                } else {
                    roadmapItems.push({ id: Date.now().toString(), ...itemData });
                }
                localStorage.setItem('hg_roadmap_items', JSON.stringify(roadmapItems));
                if (currentDiagram === 'roadmap') {
                    renderInteractiveGantt();
                }
                closeRoadmapModal();
            }
        }

        async function deleteRoadmapItem() {
            if (!editingRoadmapId || !confirm('Delete this timeline item?')) return;

            try {
                const { error } = await supabase
                    .from('roadmap_items')
                    .delete()
                    .eq('id', editingRoadmapId);
                if (error) throw error;

                await loadRoadmapItems();
            } catch (err) {
                console.error('Error deleting roadmap item:', err);
                roadmapItems = roadmapItems.filter(i => i.id !== editingRoadmapId);
                localStorage.setItem('hg_roadmap_items', JSON.stringify(roadmapItems));
            }

            if (currentDiagram === 'roadmap') {
                renderInteractiveGantt();
            }
            closeRoadmapModal();
        }

        async function loadRoadmapItems() {
            try {
                const { data, error } = await supabase
                    .from('roadmap_items')
                    .select('*')
                    .order('start_date', { ascending: true });

                if (error) throw error;
                roadmapItems = data || [];
            } catch (err) {
                console.log('Using local roadmap items:', err.message);
                // Fallback to localStorage or default items
                const stored = localStorage.getItem('hg_roadmap_items');
                if (stored) {
                    roadmapItems = JSON.parse(stored);
                } else {
                    // Initialize with default roadmap items
                    roadmapItems = [
                        { id: '1', title: 'Payment System', quarter: 'Q1 2026', start_date: '2026-01-01', duration: 90, status: 'planned', description: 'Stripe integration for subscriptions and payments' },
                        { id: '2', title: 'Stripe Integration', quarter: 'Q1 2026', start_date: '2026-01-01', duration: 30, status: 'planned', description: 'Payment processing setup' },
                        { id: '3', title: 'Video Conferencing', quarter: 'Q1 2026', start_date: '2026-01-15', duration: 90, status: 'planned', description: 'Zoom integration for workshops and consultations' },
                        { id: '4', title: 'Advanced LMS', quarter: 'Q2 2026', start_date: '2026-04-01', duration: 90, status: 'planned', description: 'Full course builder with progress tracking' },
                        { id: '5', title: 'Expert Marketplace', quarter: 'Q2 2026', start_date: '2026-04-15', duration: 90, status: 'planned', description: 'Expert profiles and booking system' },
                        { id: '6', title: 'Advanced Analytics', quarter: 'Q3 2026', start_date: '2026-07-01', duration: 90, status: 'planned', description: 'AI insights and custom report builder' },
                        { id: '7', title: 'Mobile Experience', quarter: 'Q4 2026', start_date: '2026-10-01', duration: 90, status: 'planned', description: 'PWA optimization and native apps' }
                    ];
                }
            }
        }

        // ==========================================
        // INTERACTIVE GANTT CHART
        // ==========================================

        function renderInteractiveGantt() {
            const container = document.getElementById('mermaidDiagram');
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

            // Group items by quarter
            const quarters = {
                'Q1 2026': roadmapItems.filter(i => i.quarter === 'Q1 2026'),
                'Q2 2026': roadmapItems.filter(i => i.quarter === 'Q2 2026'),
                'Q3 2026': roadmapItems.filter(i => i.quarter === 'Q3 2026'),
                'Q4 2026': roadmapItems.filter(i => i.quarter === 'Q4 2026')
            };

            container.innerHTML = `
                <div class="interactive-gantt">
                    <div class="gantt-header">
                        <h2 class="gantt-title">HumanGlue Development Roadmap 2026</h2>
                        <div class="gantt-controls">
                            <button class="btn btn-primary" onclick="openRoadmapModal()" style="padding: 8px 16px; font-size: 13px;">
                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin-right: 6px; vertical-align: -3px;">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                                </svg>
                                Add Item
                            </button>
                            <button class="btn btn-secondary" onclick="loadDiagram('roadmap', document.querySelector('[onclick*=roadmap]'))" style="padding: 8px 16px; font-size: 13px;">
                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin-right: 6px; vertical-align: -3px;">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                                </svg>
                                Refresh
                            </button>
                        </div>
                    </div>

                    <div class="gantt-months" style="margin-left: 180px;">
                        ${months.map(m => `<div class="gantt-month">${m}</div>`).join('')}
                    </div>

                    <div class="gantt-timeline">
                        ${Object.entries(quarters).map(([quarter, items]) => `
                            <div class="gantt-section">
                                <div class="gantt-section-title">${quarter}</div>
                                <div class="gantt-items">
                                    ${items.length === 0 ? `
                                        <div style="padding: 16px; color: #6b7280; font-size: 13px;">
                                            No items in ${quarter}. <a href="#" onclick="openRoadmapModal(); document.getElementById('roadmapQuarter').value='${quarter}'; return false;" style="color: var(--hg-cyan);">Add one</a>
                                        </div>
                                    ` : items.map(item => {
                                        const startDate = new Date(item.start_date);
                                        const startMonth = startDate.getMonth();
                                        const startDay = startDate.getDate();
                                        const leftPercent = ((startMonth * 30 + startDay) / 365) * 100;
                                        const widthPercent = (item.duration / 365) * 100;

                                        return `
                                            <div class="gantt-item">
                                                <div class="gantt-item-label" title="${item.title}">${item.title}</div>
                                                <div class="gantt-item-bar-container">
                                                    <div class="gantt-grid-lines">
                                                        ${months.map(() => '<div class="gantt-grid-line"></div>').join('')}
                                                    </div>
                                                    <div class="gantt-item-bar status-${item.status}"
                                                         style="left: ${leftPercent}%; width: ${Math.max(widthPercent, 5)}%;"
                                                         onclick="openRoadmapModal('${item.id}')"
                                                         title="${item.description || item.title}&#10;Duration: ${item.duration} days&#10;Click to edit">
                                                        <div class="drag-handle"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        `).join('')}

                        <button class="gantt-add-btn" onclick="openRoadmapModal()">
                            <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                            </svg>
                            Add Timeline Item
                        </button>
                    </div>

                    <div style="margin-top: 24px; padding: 16px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.2);">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                            <svg width="18" height="18" fill="none" stroke="var(--hg-blue)" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <span style="color: var(--hg-blue); font-weight: 600; font-size: 13px;">AI Tip</span>
                        </div>
                        <p style="color: #e5e7eb; font-size: 13px; margin: 0;">
                            Click on any timeline item to edit it. Add tasks from architecture diagrams and they'll sync here automatically.
                            Ask the AI assistant about dependencies or blockers for any feature.
                        </p>
                    </div>
                </div>
            `;
        }

        // ==========================================
        // KANBAN BOARD RENDERING
        // ==========================================

        function renderKanbanBoard() {
            const container = document.getElementById('mermaidDiagram');
            const columns = [
                { id: 'backlog', title: 'Backlog', dot: 'backlog' },
                { id: 'todo', title: 'To Do', dot: 'todo' },
                { id: 'progress', title: 'In Progress', dot: 'progress' },
                { id: 'review', title: 'Review', dot: 'review' },
                { id: 'done', title: 'Done', dot: 'done' }
            ];

            const totalPoints = sprintTasks.reduce((sum, t) => sum + t.points, 0);
            const donePoints = sprintTasks.filter(t => t.status === 'done').reduce((sum, t) => sum + t.points, 0);
            const progressPercent = Math.round((donePoints / totalPoints) * 100);

            container.innerHTML = `
                <div style="display: flex; flex-direction: column; height: 100%;">
                    <!-- Sprint Header -->
                    <div class="kanban-sprint-header">
                        <div class="kanban-sprint-info">
                            <span class="kanban-sprint-name">Sprint 12</span>
                            <span class="kanban-sprint-dates">Dec 2-15, 2025</span>
                        </div>
                        <div class="kanban-sprint-progress">
                            <div class="kanban-progress-bar">
                                <div class="kanban-progress-fill" style="width: ${progressPercent}%"></div>
                            </div>
                            <span class="kanban-progress-text">${donePoints}/${totalPoints} pts (${progressPercent}%)</span>
                        </div>
                    </div>

                    <!-- Sprint Stats -->
                    <div class="sprint-stats-grid">
                        <div class="sprint-stat">
                            <div class="sprint-stat-value">${sprintTasks.length}</div>
                            <div class="sprint-stat-label">Total Tasks</div>
                        </div>
                        <div class="sprint-stat">
                            <div class="sprint-stat-value" style="color: #F59E0B;">${sprintTasks.filter(t => t.status === 'progress').length}</div>
                            <div class="sprint-stat-label">In Progress</div>
                        </div>
                        <div class="sprint-stat">
                            <div class="sprint-stat-value" style="color: #10B981;">${sprintTasks.filter(t => t.status === 'done').length}</div>
                            <div class="sprint-stat-label">Completed</div>
                        </div>
                        <div class="sprint-stat">
                            <div class="sprint-stat-value">${totalPoints}</div>
                            <div class="sprint-stat-label">Story Points</div>
                        </div>
                    </div>

                    <!-- Kanban Board -->
                    <div class="kanban-board">
                        ${columns.map(col => {
                            const tasks = sprintTasks.filter(t => t.status === col.id);
                            return `
                                <div class="kanban-column" data-status="${col.id}">
                                    <div class="kanban-column-header">
                                        <div class="kanban-column-title">
                                            <span class="kanban-column-dot ${col.dot}"></span>
                                            ${col.title}
                                            <span class="kanban-column-count">${tasks.length}</span>
                                        </div>
                                    </div>
                                    <div class="kanban-column-items"
                                         ondragover="handleDragOver(event)"
                                         ondragleave="handleDragLeave(event)"
                                         ondrop="handleDrop(event, '${col.id}')">
                                        ${tasks.map(task => `
                                            <div class="kanban-card"
                                                 draggable="true"
                                                 data-task-id="${task.id}"
                                                 ondragstart="handleDragStart(event, '${task.id}')"
                                                 ondragend="handleDragEnd(event)"
                                                 onclick="openSprintTaskDetail('${task.id}')"
                                                 style="cursor: pointer;">
                                                <div class="kanban-card-title">${task.title}</div>
                                                <div class="kanban-card-meta">
                                                    <span class="kanban-card-tag ${task.type}">${task.type}</span>
                                                    <span class="kanban-card-points">${task.points} pts</span>
                                                    ${task.assignee ? `<span class="kanban-card-assignee">${task.assignee}</span>` : ''}
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                    <button class="kanban-add-card" onclick="openSprintTaskModal(null, '${col.id}')">
                                        <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                                        </svg>
                                        Add Card
                                    </button>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        // Kanban Drag and Drop
        function handleDragStart(event, taskId) {
            draggedCard = taskId;
            event.target.classList.add('dragging');
        }

        function handleDragEnd(event) {
            event.target.classList.remove('dragging');
            draggedCard = null;
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('drag-over');
        }

        function handleDragLeave(event) {
            event.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(event, newStatus) {
            event.preventDefault();
            event.currentTarget.classList.remove('drag-over');

            if (draggedCard) {
                const task = sprintTasks.find(t => t.id === draggedCard);
                if (task) {
                    task.status = newStatus;
                    renderKanbanBoard();
                    localStorage.setItem('hg_sprint_tasks', JSON.stringify(sprintTasks));
                }
            }
        }

        function openSprintTaskModal(taskId, defaultStatus = 'backlog') {
            editingSprintTaskId = taskId;
            const task = taskId ? sprintTasks.find(t => t.id === taskId) : null;

            // Reuse the roadmap modal for now with different content
            const modal = document.getElementById('roadmapModal');
            modal.querySelector('.modal-title').textContent = task ? 'Edit Task' : 'Add Task';
            modal.querySelector('.modal-body').innerHTML = `
                <div class="form-group">
                    <label class="form-label">Task Title</label>
                    <input type="text" id="sprintTaskTitle" class="form-input" value="${task?.title || ''}" placeholder="Task title...">
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea id="sprintTaskDesc" class="form-textarea" placeholder="Task description...">${task?.description || ''}</textarea>
                </div>
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select id="sprintTaskStatus" class="form-select">
                            <option value="backlog" ${(task?.status || defaultStatus) === 'backlog' ? 'selected' : ''}>Backlog</option>
                            <option value="todo" ${(task?.status || defaultStatus) === 'todo' ? 'selected' : ''}>To Do</option>
                            <option value="progress" ${(task?.status || defaultStatus) === 'progress' ? 'selected' : ''}>In Progress</option>
                            <option value="review" ${(task?.status || defaultStatus) === 'review' ? 'selected' : ''}>Review</option>
                            <option value="done" ${(task?.status || defaultStatus) === 'done' ? 'selected' : ''}>Done</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Type</label>
                        <select id="sprintTaskType" class="form-select">
                            <option value="feature" ${task?.type === 'feature' ? 'selected' : ''}>Feature</option>
                            <option value="bug" ${task?.type === 'bug' ? 'selected' : ''}>Bug</option>
                            <option value="enhancement" ${task?.type === 'enhancement' ? 'selected' : ''}>Enhancement</option>
                            <option value="docs" ${task?.type === 'docs' ? 'selected' : ''}>Docs</option>
                            <option value="design" ${task?.type === 'design' ? 'selected' : ''}>Design</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Points</label>
                        <select id="sprintTaskPoints" class="form-select">
                            <option value="1" ${task?.points === 1 ? 'selected' : ''}>1</option>
                            <option value="2" ${task?.points === 2 ? 'selected' : ''}>2</option>
                            <option value="3" ${task?.points === 3 ? 'selected' : ''}>3</option>
                            <option value="5" ${task?.points === 5 ? 'selected' : ''}>5</option>
                            <option value="8" ${task?.points === 8 ? 'selected' : ''}>8</option>
                            <option value="13" ${task?.points === 13 ? 'selected' : ''}>13</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Assignee Initials</label>
                    <input type="text" id="sprintTaskAssignee" class="form-input" value="${task?.assignee || ''}" placeholder="e.g., MS" maxlength="3">
                </div>
            `;
            modal.querySelector('.modal-actions').innerHTML = `
                ${task ? '<button class="btn btn-danger" onclick="deleteSprintTask()">Delete</button>' : ''}
                <button class="btn btn-secondary" onclick="closeRoadmapModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveSprintTask()">Save Task</button>
            `;
            modal.classList.add('show');
        }

        function saveSprintTask() {
            const taskData = {
                title: document.getElementById('sprintTaskTitle').value,
                description: document.getElementById('sprintTaskDesc').value,
                status: document.getElementById('sprintTaskStatus').value,
                type: document.getElementById('sprintTaskType').value,
                points: parseInt(document.getElementById('sprintTaskPoints').value),
                assignee: document.getElementById('sprintTaskAssignee').value
            };

            if (editingSprintTaskId) {
                const idx = sprintTasks.findIndex(t => t.id === editingSprintTaskId);
                if (idx !== -1) {
                    sprintTasks[idx] = { ...sprintTasks[idx], ...taskData };
                }
            } else {
                sprintTasks.push({ id: Date.now().toString(), ...taskData });
            }

            localStorage.setItem('hg_sprint_tasks', JSON.stringify(sprintTasks));
            renderKanbanBoard();
            closeRoadmapModal();
        }

        function deleteSprintTask() {
            if (editingSprintTaskId && confirm('Delete this task?')) {
                sprintTasks = sprintTasks.filter(t => t.id !== editingSprintTaskId);
                localStorage.setItem('hg_sprint_tasks', JSON.stringify(sprintTasks));
                renderKanbanBoard();
                closeRoadmapModal();
            }
        }

        // ==========================================
        // MIND MAP RENDERING
        // ==========================================

        function renderMindMap() {
            const container = document.getElementById('mermaidDiagram');

            container.innerHTML = `
                <div style="position: relative; width: 100%; height: 100%; min-height: 600px; overflow: hidden;">
                    <svg id="mindMapSvg" width="100%" height="100%" style="position: absolute; top: 0; left: 0;">
                        <!-- Connection lines will be drawn here -->
                    </svg>
                    <div id="mindMapNodes" style="position: relative; width: 100%; height: 100%;">
                        ${mindMapNodes.map(node => `
                            <div class="mindmap-node"
                                 data-node-id="${node.id}"
                                 style="
                                    position: absolute;
                                    left: ${node.x}px;
                                    top: ${node.y}px;
                                    background: ${node.color}20;
                                    border: 2px solid ${node.color};
                                    border-radius: 12px;
                                    padding: 12px 20px;
                                    cursor: grab;
                                    transition: transform 0.1s, box-shadow 0.2s;
                                    z-index: 10;
                                    font-size: ${node.id === 'root' ? '16px' : '13px'};
                                    font-weight: ${node.id === 'root' ? '600' : '500'};
                                    color: ${node.color};
                                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                                    ${node.status === 'blocked' ? 'opacity: 0.6; border-style: dashed;' : ''}
                                    ${node.prunable ? 'border-style: dotted;' : ''}
                                 "
                                 onmousedown="startMindMapDrag(event, '${node.id}')"
                                 onclick="handleMindMapNodeClick('${node.id}')"
                                 title=" ${node.label}&#10; Priority: ${node.priority || 'medium'}&#10; ${node.why || 'No context'}&#10;${node.prunable ? ' PRUNABLE - Consider deferring' : ' Essential'}">
                                ${node.children && node.children.length > 0 ? `
                                    <span style="margin-right: 6px; opacity: 0.7;">${node.expanded ? '' : '+'}</span>
                                ` : ''}
                                ${node.priority === 'critical' ? ' ' : node.priority === 'high' ? ' ' : node.priority === 'low' ? ' ' : ' '}
                                ${node.label}
                                ${node.status === 'blocked' ? '<span style="margin-left: 6px;"></span>' : ''}
                                ${node.prunable ? '<span style="margin-left: 6px; font-size: 10px;"></span>' : ''}
                            </div>
                        `).join('')}
                    </div>

                    <!-- Node Palette -->
                    <div class="node-palette visible" style="display: flex;">
                        <span class="node-palette-title">Add Node:</span>
                        <button class="node-palette-item component" onclick="addMindMapNode('component')">
                            <svg width="12" height="12" fill="currentColor" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/></svg>
                            Component
                        </button>
                        <button class="node-palette-item service" onclick="addMindMapNode('service')">
                            <svg width="12" height="12" fill="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9"/></svg>
                            Service
                        </button>
                        <button class="node-palette-item database" onclick="addMindMapNode('database')">
                            <svg width="12" height="12" fill="currentColor" viewBox="0 0 24 24"><ellipse cx="12" cy="6" rx="8" ry="3"/><path d="M4 6v12c0 1.66 3.58 3 8 3s8-1.34 8-3V6"/></svg>
                            Database
                        </button>
                        <button class="node-palette-item external" onclick="addMindMapNode('external')">
                            <svg width="12" height="12" fill="currentColor" viewBox="0 0 24 24"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6M15 3h6v6M10 14L21 3"/></svg>
                            External
                        </button>
                    </div>
                </div>
            `;

            // Draw connection lines
            drawMindMapConnections();
        }

        function drawMindMapConnections() {
            const svg = document.getElementById('mindMapSvg');
            if (!svg) return;

            let lines = '';
            mindMapNodes.forEach(node => {
                if (node.children && node.expanded) {
                    node.children.forEach(childId => {
                        const child = mindMapNodes.find(n => n.id === childId);
                        if (child) {
                            const x1 = node.x + 80;
                            const y1 = node.y + 20;
                            const x2 = child.x + 40;
                            const y2 = child.y + 20;
                            const midX = (x1 + x2) / 2;

                            lines += `
                                <path d="M ${x1} ${y1} C ${midX} ${y1}, ${midX} ${y2}, ${x2} ${y2}"
                                      stroke="${child.color || '#61D8FE'}"
                                      stroke-width="2"
                                      fill="none"
                                      stroke-opacity="0.5"/>
                            `;
                        }
                    });
                }
            });
            svg.innerHTML = lines;
        }

        function handleMindMapNodeClick(nodeId) {
            const node = mindMapNodes.find(n => n.id === nodeId);
            if (node && node.children && node.children.length > 0) {
                node.expanded = !node.expanded;
                renderMindMap();
            } else {
                // Show AI tooltip for leaf nodes
                const context = componentContext[nodeId] || componentContext['default'];
                showAITooltip(nodeId, node.label, event.clientX, event.clientY);
            }
        }

        function addMindMapNode(type) {
            const colors = {
                component: '#61D8FE',
                service: '#3B82F6',
                database: '#10B981',
                external: '#F59E0B'
            };

            const newNode = {
                id: 'node_' + Date.now(),
                label: 'New ' + type.charAt(0).toUpperCase() + type.slice(1),
                x: 400 + Math.random() * 200 - 100,
                y: 300 + Math.random() * 200 - 100,
                children: [],
                expanded: false,
                color: colors[type]
            };

            mindMapNodes.push(newNode);
            renderMindMap();
        }

        // ==========================================
        // MIND MAP DRAG FUNCTIONS
        // ==========================================

        function startMindMapDrag(event, nodeId) {
            event.stopPropagation();
            const node = mindMapNodes.find(n => n.id === nodeId);
            if (!node) return;

            mindMapDragState = {
                isDragging: true,
                nodeId: nodeId,
                startX: event.clientX,
                startY: event.clientY,
                originalX: node.x,
                originalY: node.y
            };

            document.addEventListener('mousemove', handleMindMapDrag);
            document.addEventListener('mouseup', stopMindMapDrag);
            event.target.style.cursor = 'grabbing';
        }

        function handleMindMapDrag(event) {
            if (!mindMapDragState.isDragging) return;

            const node = mindMapNodes.find(n => n.id === mindMapDragState.nodeId);
            if (!node) return;

            const dx = event.clientX - mindMapDragState.startX;
            const dy = event.clientY - mindMapDragState.startY;

            node.x = mindMapDragState.originalX + dx;
            node.y = mindMapDragState.originalY + dy;

            renderMindMap();
        }

        function stopMindMapDrag(event) {
            if (mindMapDragState.isDragging) {
                document.removeEventListener('mousemove', handleMindMapDrag);
                document.removeEventListener('mouseup', stopMindMapDrag);
                mindMapDragState.isDragging = false;
                mindMapDragState.nodeId = null;
            }
        }

        // ==========================================
        // EXPERT ADVISORS FUNCTIONS
        // ==========================================

        let currentExpert = 'ai'; // Default to AI assistant
        let selectedChatExpert = 'ai';

        function selectExpertForChat(expertId) {
            selectedChatExpert = expertId;

            // Update button states
            document.querySelectorAll('.expert-chip').forEach(btn => {
                btn.style.border = '1px solid var(--border-subtle)';
                btn.style.background = 'var(--bg-tertiary)';
                btn.style.color = 'var(--text-secondary)';
            });

            const activeBtn = document.getElementById(`expert-btn-${expertId}`);
            if (activeBtn) {
                activeBtn.style.border = '1px solid var(--hg-cyan)';
                activeBtn.style.background = 'rgba(97, 216, 254, 0.1)';
                activeBtn.style.color = 'var(--hg-cyan)';
            }

            // Update chat placeholder
            const chatInput = document.getElementById('chatInput');
            const expertNames = {
                'ai': 'the project',
                'steve-jobs': 'Steve Jobs about product vision',
                'paul-graham': 'Paul Graham about startup strategy',
                'jony-ive': 'Jony Ive about design'
            };
            chatInput.placeholder = `Ask ${expertNames[expertId]}...`;

            // Add expert switch message to chat
            const chatMessages = document.getElementById('chatMessages');
            const expertDisplayNames = {
                'ai': ' AI Project Assistant',
                'steve-jobs': ' Steve Jobs',
                'paul-graham': ' Paul Graham',
                'jony-ive': ' Jony Ive'
            };

            const switchMessage = document.createElement('div');
            switchMessage.className = 'chat-message system';
            switchMessage.innerHTML = `
                <div style="text-align: center; padding: 8px; color: var(--text-muted); font-size: 12px;">
                    Now chatting with <strong style="color: var(--hg-cyan);">${expertDisplayNames[expertId]}</strong>
                </div>
            `;
            chatMessages.appendChild(switchMessage);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function toggleExpertsList() {
            const modal = document.getElementById('expertsModal');
            if (modal.style.display === 'flex') {
                closeExpertsModal();
            } else {
                modal.style.display = 'flex';
            }
        }

        function closeExpertsModal() {
            const modal = document.getElementById('expertsModal');
            if (modal) modal.style.display = 'none';
        }

        function consultExpert(expertId) {
            currentExpert = expertId;
            const expertNames = {
                'steve-jobs': 'Steve Jobs',
                'paul-graham': 'Paul Graham',
                'jony-ive': 'Jony Ive'
            };
            const expertDescriptions = {
                'steve-jobs': 'Focus, simplicity, and user experience. Will challenge you on product vision and push for excellence.',
                'paul-graham': 'Startup strategy, product-market fit, and lean execution. Will probe your assumptions and help refine your business model.',
                'jony-ive': 'Design thinking, craftsmanship, and attention to detail. Will help you think about form, function, and the emotional impact of your product.'
            };

            document.getElementById('expertConsultTitle').textContent = `Consult with ${expertNames[expertId]}`;
            document.getElementById('expertConsultDescription').textContent = expertDescriptions[expertId];
            document.getElementById('expertConsultModal').style.display = 'flex';
            closeExpertsModal();
        }

        function closeExpertConsultModal() {
            document.getElementById('expertConsultModal').style.display = 'none';
            currentExpert = null;
        }

        async function sendExpertQuery() {
            const input = document.getElementById('expertQueryInput');
            const query = input.value.trim();
            if (!query) return;

            const responseDiv = document.getElementById('expertResponse');
            responseDiv.innerHTML = '<div style="color: var(--hg-cyan);"> Thinking...</div>';

            // Get project context
            const projectContext = `
                Project: HumanGlue Platform
                Current Phase: MVP Development
                Components: ${mindMapNodes.map(n => n.label).join(', ')}
                Critical Items: ${mindMapNodes.filter(n => n.priority === 'critical').map(n => n.label).join(', ')}
                Prunable: ${mindMapNodes.filter(n => n.prunable).map(n => n.label).join(', ') || 'None identified'}
            `;

            // Simulate expert response (in real implementation, would call Mind Reasoner API)
            setTimeout(() => {
                const responses = {
                    'steve-jobs': `Focus. That's what's missing in most products. You have ${mindMapNodes.length} components here. Do you really need all of them for your MVP? I see some marked as prunable - that's good thinking. But let me challenge you: what's the ONE thing that makes HumanGlue irreplaceable? Start there. Everything else is a distraction until you nail that.`,
                    'paul-graham': `Looking at your architecture, the question isn't whether it's technically sound - it's whether you're building something people desperately want. Your Assessment Engine seems to be the core. Have you talked to 10 potential customers this week? What's the conversion rate on your current prototype? The best startups I've seen don't worry about perfect architecture - they worry about finding product-market fit first.`,
                    'jony-ive': `The complexity I see here concerns me from a user experience perspective. Every component you add is another cognitive load on your users. Think about the journey: someone comes to HumanGlue, what do they see first? How does each interaction feel? The best products feel inevitable, as if they couldn't have been designed any other way. Does yours?`
                };
                responseDiv.innerHTML = `<div style="color: var(--text-primary); line-height: 1.6;">${responses[currentExpert] || 'Expert response would appear here...'}</div>`;
            }, 1500);

            input.value = '';
        }

        function askExpertQuickQuestion(question) {
            document.getElementById('expertQueryInput').value = question;
            sendExpertQuery();
        }

        // ==========================================
        // CUSTOM SECTIONS FUNCTIONS
        // ==========================================

        let customSections = JSON.parse(localStorage.getItem('hg_custom_sections') || '[]');
        let newSectionColor = '#61D8FE';

        function openAddSectionModal() {
            document.getElementById('addSectionModal').style.display = 'flex';
            document.getElementById('newSectionName').value = '';
            document.getElementById('newSectionDescription').value = '';
        }

        function closeAddSectionModal() {
            document.getElementById('addSectionModal').style.display = 'none';
        }

        function setNewSectionColor(color) {
            newSectionColor = color;
            document.querySelectorAll('.color-option').forEach(opt => {
                opt.style.border = opt.dataset.color === color ? '2px solid white' : '2px solid transparent';
            });
        }

        function saveCustomSection() {
            const name = document.getElementById('newSectionName').value.trim();
            const description = document.getElementById('newSectionDescription').value.trim();

            if (!name) {
                alert('Please enter a section name');
                return;
            }

            const section = {
                id: 'section_' + Date.now(),
                name: name,
                description: description,
                color: newSectionColor,
                created: new Date().toISOString()
            };

            customSections.push(section);
            localStorage.setItem('hg_custom_sections', JSON.stringify(customSections));
            renderCustomSections();
            closeAddSectionModal();
        }

        function renderCustomSections() {
            const container = document.getElementById('customSectionsContainer');
            if (!container) return;

            container.innerHTML = customSections.map(section => `
                <button class="nav-item" onclick="showCustomSection('${section.id}')" style="border-left: 3px solid ${section.color};">
                    ${section.name}
                </button>
            `).join('');
        }

        function showCustomSection(sectionId) {
            const section = customSections.find(s => s.id === sectionId);
            if (!section) return;

            // For now, show in the main content area
            const content = document.getElementById('mainContent');
            content.innerHTML = `
                <div style="padding: 20px;">
                    <h2 style="color: ${section.color}; margin-bottom: 10px;">${section.name}</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">${section.description || 'No description provided.'}</p>
                    <div style="background: var(--bg-secondary); border-radius: 8px; padding: 20px; border: 1px solid var(--border-subtle);">
                        <p style="color: var(--text-muted);">This custom section is ready for your content. You can add notes, diagrams, or any project documentation here.</p>
                    </div>
                </div>
            `;
        }

        function deleteCustomSection(sectionId) {
            customSections = customSections.filter(s => s.id !== sectionId);
            localStorage.setItem('hg_custom_sections', JSON.stringify(customSections));
            renderCustomSections();
        }

        // ==========================================
        // SPRINT CARD DETAIL FUNCTIONS
        // ==========================================

        const sprintTaskDetails = {
            'onboarding-flow': {
                title: 'Organization Onboarding Flow',
                status: 'done',
                priority: 'critical',
                description: 'Complete signup and onboarding experience for new organizations including account creation, team setup, and initial configuration.',
                components: ['Authentication System', 'User Management', 'Organization Settings', 'Email Notifications'],
                dependencies: ['Supabase Auth', 'Email Service (Resend)', 'Database Schema'],
                linkedFiles: [
                    { path: 'app/signup/page.tsx', status: 'complete' },
                    { path: 'app/api/organizations/register/route.ts', status: 'complete' },
                    { path: 'lib/email-templates.ts', status: 'complete' }
                ],
                acceptanceCriteria: [
                    { text: 'User can create organization account', done: true },
                    { text: 'Email verification sent on signup', done: true },
                    { text: 'Admin can invite team members', done: true },
                    { text: 'Organization settings page functional', done: true }
                ],
                notes: 'Implemented with Supabase Auth. Supports SSO for enterprise tier.'
            },
            'assessment-engine': {
                title: 'AI Assessment Engine',
                status: 'in-progress',
                priority: 'critical',
                description: 'Core assessment engine that powers the AI maturity evaluation. Integrates VAPI for voice interactions and generates comprehensive reports.',
                components: ['VAPI Integration', 'Scoring Algorithm', 'Report Generator', 'PDF Export'],
                dependencies: ['VAPI API', 'Assessment Schema', 'Supabase Database'],
                linkedFiles: [
                    { path: 'app/api/assessments/[id]/pdf/route.ts', status: 'in-progress' },
                    { path: 'lib/services/assessment-scoring.ts', status: 'complete' },
                    { path: 'components/organisms/AssessmentFlow.tsx', status: 'in-progress' }
                ],
                acceptanceCriteria: [
                    { text: 'Voice assessment via VAPI works end-to-end', done: true },
                    { text: 'Scoring algorithm calculates maturity level', done: true },
                    { text: 'PDF reports generate correctly', done: false },
                    { text: 'Results stored in database', done: true }
                ],
                notes: 'PDF export having issues with chart rendering. Need to investigate.'
            },
            'admin-dashboard': {
                title: 'Admin Dashboard',
                status: 'in-progress',
                priority: 'high',
                description: 'Comprehensive admin interface for managing organizations, users, assessments, and platform analytics.',
                components: ['Analytics Charts', 'User Management', 'Assessment Viewer', 'Settings Panel'],
                dependencies: ['Recharts Library', 'Supabase Admin API', 'Role-based Access'],
                linkedFiles: [
                    { path: 'app/admin/page.tsx', status: 'in-progress' },
                    { path: 'app/admin/analytics/page.tsx', status: 'in-progress' },
                    { path: 'app/admin/users/page.tsx', status: 'complete' },
                    { path: 'components/organisms/DashboardSidebar.tsx', status: 'complete' }
                ],
                acceptanceCriteria: [
                    { text: 'Dashboard shows key metrics', done: true },
                    { text: 'Can view all organizations', done: true },
                    { text: 'Can manage user roles', done: true },
                    { text: 'Analytics charts render correctly', done: false }
                ],
                notes: 'Charts need color scheme update to match new branding.'
            },
            'expert-network': {
                title: 'Expert Application System',
                status: 'todo',
                priority: 'medium',
                description: 'Allow industry experts to apply to join the HumanGlue expert network. Includes application form, review workflow, and expert profiles.',
                components: ['Application Form', 'Admin Review Panel', 'Expert Profiles', 'Matching Algorithm'],
                dependencies: ['Supabase Storage (resumes)', 'Email Notifications', 'Expert Schema'],
                linkedFiles: [
                    { path: 'app/apply/page.tsx', status: 'planned' },
                    { path: 'app/api/expert-applications/route.ts', status: 'planned' },
                    { path: 'app/admin/applications/page.tsx', status: 'planned' }
                ],
                acceptanceCriteria: [
                    { text: 'Experts can submit application', done: false },
                    { text: 'Admin can review applications', done: false },
                    { text: 'Approved experts appear in directory', done: false },
                    { text: 'Email notifications for status changes', done: false }
                ],
                notes: 'Database migration ready. Need to implement UI components.'
            },
            'video-conferencing': {
                title: 'Video Conferencing Integration',
                status: 'todo',
                priority: 'medium',
                description: 'Integrate video conferencing for live consultations between clients and experts.',
                components: ['Daily.co Integration', 'Meeting Scheduler', 'Recording Storage', 'Transcription'],
                dependencies: ['Daily.co API', 'Calendar System', 'Supabase Storage'],
                linkedFiles: [
                    { path: 'lib/services/video-conferencing.ts', status: 'in-progress' },
                    { path: 'app/api/video-conferencing/meetings/route.ts', status: 'planned' }
                ],
                acceptanceCriteria: [
                    { text: 'Can schedule video meetings', done: false },
                    { text: 'Video calls work in browser', done: false },
                    { text: 'Recordings saved to storage', done: false },
                    { text: 'AI transcription generated', done: false }
                ],
                notes: 'Daily.co preferred over Zoom for better API experience.'
            }
        };

        function openSprintTaskDetail(taskId) {
            // First try to get from detailed predefined data
            let task = sprintTaskDetails[taskId];

            // If not found, get from sprint tasks array
            if (!task) {
                const sprintTask = sprintTasks.find(t => t.id === taskId);
                if (!sprintTask) {
                    console.warn('Task not found:', taskId);
                    return;
                }

                // Build a basic task object from sprint data
                const statusMapping = {
                    'done': 'done',
                    'progress': 'in-progress',
                    'todo': 'todo',
                    'backlog': 'todo'
                };

                task = {
                    title: sprintTask.title,
                    status: statusMapping[sprintTask.status] || 'todo',
                    priority: sprintTask.points >= 8 ? 'high' : sprintTask.points >= 5 ? 'medium' : 'low',
                    description: sprintTask.description || 'No detailed description available.',
                    components: [sprintTask.type.charAt(0).toUpperCase() + sprintTask.type.slice(1)],
                    dependencies: [],
                    linkedFiles: [],
                    acceptanceCriteria: [
                        { text: 'Task completed as specified', done: sprintTask.status === 'done' }
                    ],
                    notes: `Assigned to: ${sprintTask.assignee || 'Unassigned'} | Story Points: ${sprintTask.points}`
                };
            }

            const statusColors = {
                'done': '#10B981',
                'in-progress': '#3B82F6',
                'todo': '#6B7280'
            };
            const statusLabels = {
                'done': 'Completed',
                'in-progress': 'In Progress',
                'todo': 'To Do'
            };

            const modal = document.createElement('div');
            modal.id = 'sprintTaskModal';
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
                    <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h2 style="margin-bottom: 8px;">${task.title}</h2>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <span class="status-badge" style="background: ${statusColors[task.status]}20; color: ${statusColors[task.status]}; padding: 4px 12px; border-radius: 12px; font-size: 12px;">
                                    ${statusLabels[task.status]}
                                </span>
                                <span style="color: var(--text-muted); font-size: 12px;">Priority: ${task.priority}</span>
                            </div>
                        </div>
                        <button onclick="closeSprintTaskModal()" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">&times;</button>
                    </div>

                    <div style="margin-top: 20px;">
                        <p style="color: var(--text-secondary); line-height: 1.6;">${task.description}</p>
                    </div>

                    <div style="margin-top: 24px;">
                        <h4 style="color: var(--hg-cyan); margin-bottom: 12px;"> Components</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            ${task.components.map(c => `<span style="background: var(--bg-tertiary); padding: 6px 12px; border-radius: 6px; font-size: 12px;">${c}</span>`).join('')}
                        </div>
                    </div>

                    <div style="margin-top: 24px;">
                        <h4 style="color: var(--hg-cyan); margin-bottom: 12px;"> Dependencies</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            ${task.dependencies.map(d => `<span style="background: rgba(59, 130, 246, 0.1); color: #3B82F6; padding: 6px 12px; border-radius: 6px; font-size: 12px;">${d}</span>`).join('')}
                        </div>
                    </div>

                    <div style="margin-top: 24px;">
                        <h4 style="color: var(--hg-cyan); margin-bottom: 12px;"> Linked Files</h4>
                        <div style="background: var(--bg-secondary); border-radius: 8px; padding: 12px;">
                            ${task.linkedFiles.map(f => `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; border-bottom: 1px solid var(--border-subtle);">
                                    <code style="font-size: 12px; color: var(--text-primary);">${f.path}</code>
                                    <span style="font-size: 11px; padding: 2px 8px; border-radius: 4px; background: ${f.status === 'complete' ? '#10B98120' : f.status === 'in-progress' ? '#3B82F620' : '#6B728020'}; color: ${f.status === 'complete' ? '#10B981' : f.status === 'in-progress' ? '#3B82F6' : '#6B7280'};">
                                        ${f.status}
                                    </span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div style="margin-top: 24px;">
                        <h4 style="color: var(--hg-cyan); margin-bottom: 12px;"> Acceptance Criteria</h4>
                        <div style="background: var(--bg-secondary); border-radius: 8px; padding: 12px;">
                            ${task.acceptanceCriteria.map(c => `
                                <div style="display: flex; align-items: center; gap: 10px; padding: 8px;">
                                    <span style="color: ${c.done ? '#10B981' : '#6B7280'};">${c.done ? '' : ''}</span>
                                    <span style="color: ${c.done ? 'var(--text-primary)' : 'var(--text-secondary)'}; ${c.done ? '' : 'opacity: 0.7;'}">${c.text}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div style="margin-top: 24px;">
                        <h4 style="color: var(--hg-cyan); margin-bottom: 12px;"> Notes</h4>
                        <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 16px; border-left: 3px solid var(--hg-cyan);">
                            <p style="color: var(--text-secondary); font-style: italic;">${task.notes}</p>
                        </div>
                    </div>

                    <div style="margin-top: 24px; display: flex; gap: 12px; justify-content: flex-end;">
                        <button onclick="openInMindMap('${taskId}')" style="background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-subtle); padding: 10px 20px; border-radius: 6px; cursor: pointer;">
                             View in Mind Map
                        </button>
                        <button onclick="closeSprintTaskModal()" style="background: var(--hg-cyan); color: black; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 500;">
                            Close
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
        }

        function closeSprintTaskModal() {
            const modal = document.getElementById('sprintTaskModal');
            if (modal) {
                modal.remove();
            }
        }

        function openInMindMap(taskId) {
            closeSprintTaskModal();
            showView('architecture');
            // Highlight the relevant node
            setTimeout(() => {
                const nodeMapping = {
                    'onboarding-flow': 'admin',
                    'assessment-engine': 'assessment',
                    'admin-dashboard': 'admin',
                    'expert-network': 'client',
                    'video-conferencing': 'integrations'
                };
                const nodeId = nodeMapping[taskId];
                if (nodeId) {
                    const node = mindMapNodes.find(n => n.id === nodeId);
                    if (node) {
                        node.expanded = true;
                        renderMindMap();
                    }
                }
            }, 100);
        }

        // ==========================================
        // SIDEBAR COLLAPSE FUNCTIONS
        // ==========================================

        function toggleSidebar() {
            const container = document.querySelector('.app-container');
            container.classList.toggle('sidebar-collapsed');
            // Save preference
            localStorage.setItem('hg_sidebar_collapsed', container.classList.contains('sidebar-collapsed'));
        }

        function toggleRightPanel() {
            const container = document.querySelector('.app-container');
            container.classList.toggle('right-collapsed');
            // Save preference
            localStorage.setItem('hg_right_collapsed', container.classList.contains('right-collapsed'));
        }

        // Restore sidebar state on load
        function restoreSidebarState() {
            const container = document.querySelector('.app-container');
            if (localStorage.getItem('hg_sidebar_collapsed') === 'true') {
                container.classList.add('sidebar-collapsed');
            }
            if (localStorage.getItem('hg_right_collapsed') === 'true') {
                container.classList.add('right-collapsed');
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeNoteModal();
                closeSettingsModal();
                closeRoadmapModal();
                hideAITooltip();
                closeExpertsModal();
                closeExpertConsultModal();
                closeAddSectionModal();
                closeSprintTaskModal();
            }
            if ((e.ctrlKey || e.metaKey) && e.key === '=') {
                e.preventDefault();
                zoomIn();
            }
            if ((e.ctrlKey || e.metaKey) && e.key === '-') {
                e.preventDefault();
                zoomOut();
            }
            if ((e.ctrlKey || e.metaKey) && e.key === '0') {
                e.preventDefault();
                resetZoom();
            }
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                openNoteModal();
            }
            // Toggle sidebars with [ and ]
            if (e.key === '[' && !e.ctrlKey && !e.metaKey) {
                toggleSidebar();
            }
            if (e.key === ']' && !e.ctrlKey && !e.metaKey) {
                toggleRightPanel();
            }
        });

        // Service worker for offline support (optional)
        if ('serviceWorker' in navigator) {
            // Could register a service worker for offline functionality
        }
    </script>
</body>
</html>
